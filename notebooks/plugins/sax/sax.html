
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>SAX circuit simulator &#8212; gdsfactory 6.17.0 documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/autodoc_pydantic.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Lumerical INTERCONNECT" href="../lumerical/2_interconnect.html" />
    <link rel="prev" title="Plugins: Circuit simulators" href="../../../plugins_circuits.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../../_static/logo.png" class="logo" alt="logo">
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../README.html">
   gdsfactory 6.17.0
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../git.html">
   Installation
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../_2_install.html">
     Install gdsfactory
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../_2_klayout.html">
     KLayout integration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../_3_vscode.html">
     VScode, PyCharm, Spyder, JupyterLab integration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../_4_gdsfactory_in_5minutes.html">
     gdsfactory in 5 minutes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../_0_python.html">
     Python intro
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../_1_git.html">
     Git: Version control intro
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../workflow.html">
   Workflow
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../notebooks.html">
   Layout tutorial
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../00_geometry.html">
     Component
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../01_references.html">
     References and ports
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../02_movement.html">
     Movement
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../03_cells_autoname_and_cache.html">
     Cell
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../03_layer_stack.html">
     Layers
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../03_waveguides_paths_crossections.html">
     Path and CrossSection
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../04_components_.html">
     Components
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../04_components_hierarchy.html">
     Components with hierarchy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../08_pdk.html">
     PDK
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../09_pdk_import.html">
     Import PDK
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../07_mask.html">
     Reticle assembly
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../04_routing.html">
     Routing optical and RF ports
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../041_routing_electrical.html">
     Routing electrical
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../common_mistakes.html">
     Common mistakes
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../sdl.html">
   Schematic Driven Layout
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../20_schematic_driven_layout.html">
     Schematic Driven layout
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../10_yaml_component.html">
     YAML Place and AutoRoute
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../11_get_netlist.html">
     get_netlist
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../plugins_mesh.html">
   Plugins: Materials and Mesh
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../materials.html">
     Materials
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../meshing/01_intro.html">
     Meshing introduction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../meshing/02_2D_xy_mesh.html">
     2D meshing: xy cross-section
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../meshing/03_2D_uz_mesh.html">
     2D meshing: uz cross-section
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../meshing/04_refinement.html">
     Controlling mesh resolution
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../plugins_process.html">
   Plugins: Device simulators
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../devsim/01_pin_waveguide.html">
     DEVSIM TCAD simulator
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../thermal/thermal.html">
     Thermal
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../plugins_mode_solver.html">
   Plugins: Mode solvers
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../fem/01_mode_solving.html">
     Finite-element mode solver
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tidy3d/01_tidy3d_modes.html">
     Tidy3D mode solver
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../mpb/001_mpb_waveguide.html">
     MPB mode-solver
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../eme/01_meow.html">
     EME with MEOW
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../plugins_fdtd.html">
   Plugins: FDTD
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../tidy3d/00_tidy3d.html">
     FDTD tidy3d
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../meep/001_meep_sparameters.html">
     Meep FDTD
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../meep/002_gratings.html">
     FDTD Meep gratings
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../lumerical/1_fdtd_sparameters.html">
     FDTD Lumerical
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../../../plugins_circuits.html">
   Plugins: Circuit simulators
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     SAX circuit simulator
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../lumerical/2_interconnect.html">
     Lumerical INTERCONNECT
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../contribution.html">
   Contributing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../CHANGELOG.html">
   CHANGELOG
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../components.html">
   Components
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../api.html">
   API
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.Component.html">
     gdsfactory.Component
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.ComponentReference.html">
     gdsfactory.ComponentReference
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.read.import_gds.html">
     gdsfactory.read.import_gds
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.read.from_yaml.html">
     gdsfactory.read.from_yaml
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.read.from_np.html">
     gdsfactory.read.from_np
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.read.from_phidl.html">
     gdsfactory.read.from_phidl
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.read.from_dphox.html">
     gdsfactory.read.from_dphox
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.path.Path.html">
     gdsfactory.path.Path
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.path.straight.html">
     gdsfactory.path.straight
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.path.euler.html">
     gdsfactory.path.euler
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.path.arc.html">
     gdsfactory.path.arc
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.path.spiral_archimedean.html">
     gdsfactory.path.spiral_archimedean
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.path.smooth.html">
     gdsfactory.path.smooth
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.cross_section.CrossSection.html">
     gdsfactory.cross_section.CrossSection
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.cross_section.Transition.html">
     gdsfactory.cross_section.Transition
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.cross_section.cross_section.html">
     gdsfactory.cross_section.cross_section
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.cross_section.strip.html">
     gdsfactory.cross_section.strip
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.cross_section.strip_auto_widen.html">
     gdsfactory.cross_section.strip_auto_widen
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.cross_section.heater_metal.html">
     gdsfactory.cross_section.heater_metal
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.cross_section.pin.html">
     gdsfactory.cross_section.pin
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.cross_section.pn.html">
     gdsfactory.cross_section.pn
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.cross_section.strip_heater_metal_undercut.html">
     gdsfactory.cross_section.strip_heater_metal_undercut
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.cross_section.strip_heater_metal.html">
     gdsfactory.cross_section.strip_heater_metal
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.cross_section.strip_heater_doped.html">
     gdsfactory.cross_section.strip_heater_doped
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.cross_section.rib_heater_doped.html">
     gdsfactory.cross_section.rib_heater_doped
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.cross_section.rib_heater_doped_via_stack.html">
     gdsfactory.cross_section.rib_heater_doped_via_stack
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.path.transition.html">
     gdsfactory.path.transition
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.cell.html">
     gdsfactory.cell
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.cell_without_validator.html">
     gdsfactory.cell_without_validator
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.types.Layer.html">
     gdsfactory.types.Layer
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.types.ComponentSpec.html">
     gdsfactory.types.ComponentSpec
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.types.LayerSpec.html">
     gdsfactory.types.LayerSpec
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.types.CrossSectionSpec.html">
     gdsfactory.types.CrossSectionSpec
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.types.CellSpec.html">
     gdsfactory.types.CellSpec
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.pack.html">
     gdsfactory.pack
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.grid.html">
     gdsfactory.grid
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.grid_with_text.html">
     gdsfactory.grid_with_text
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.get_netlist.get_netlist.html">
     gdsfactory.get_netlist.get_netlist
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.geometry.write_drc.write_drc_deck_macro.html">
     gdsfactory.geometry.write_drc.write_drc_deck_macro
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.geometry.write_drc.rule_width.html">
     gdsfactory.geometry.write_drc.rule_width
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.geometry.write_drc.rule_space.html">
     gdsfactory.geometry.write_drc.rule_space
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.geometry.write_drc.rule_min_width_or_space.html">
     gdsfactory.geometry.write_drc.rule_min_width_or_space
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.geometry.write_drc.rule_separation.html">
     gdsfactory.geometry.write_drc.rule_separation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.geometry.write_drc.rule_enclosing.html">
     gdsfactory.geometry.write_drc.rule_enclosing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.geometry.write_drc.rule_area.html">
     gdsfactory.geometry.write_drc.rule_area
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.geometry.write_drc.rule_density.html">
     gdsfactory.geometry.write_drc.rule_density
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.geometry.write_drc.rule_not_inside.html">
     gdsfactory.geometry.write_drc.rule_not_inside
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.simulation.gtidy3d.modes.Waveguide.html">
     gdsfactory.simulation.gtidy3d.modes.Waveguide
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.simulation.gtidy3d.modes.WaveguideCoupler.html">
     gdsfactory.simulation.gtidy3d.modes.WaveguideCoupler
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.simulation.gtidy3d.modes.sweep_width.html">
     gdsfactory.simulation.gtidy3d.modes.sweep_width
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.simulation.gtidy3d.modes.sweep_bend_loss.html">
     gdsfactory.simulation.gtidy3d.modes.sweep_bend_loss
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.simulation.gtidy3d.modes.group_index.html">
     gdsfactory.simulation.gtidy3d.modes.group_index
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.simulation.gtidy3d.modes.plot_sweep_width.html">
     gdsfactory.simulation.gtidy3d.modes.plot_sweep_width
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.simulation.eme.MEOW.html">
     gdsfactory.simulation.eme.MEOW
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.simulation.modes.find_modes_waveguide.html">
     gdsfactory.simulation.modes.find_modes_waveguide
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.simulation.modes.find_modes_coupler.html">
     gdsfactory.simulation.modes.find_modes_coupler
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.simulation.modes.find_neff_vs_width.html">
     gdsfactory.simulation.modes.find_neff_vs_width
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.simulation.modes.find_mode_dispersion.html">
     gdsfactory.simulation.modes.find_mode_dispersion
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.simulation.modes.find_coupling_vs_gap.html">
     gdsfactory.simulation.modes.find_coupling_vs_gap
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.simulation.modes.find_neff_ng_dw_dh.html">
     gdsfactory.simulation.modes.find_neff_ng_dw_dh
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.simulation.modes.plot_neff_ng_dw_dh.html">
     gdsfactory.simulation.modes.plot_neff_ng_dw_dh
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.simulation.modes.plot_neff_vs_width.html">
     gdsfactory.simulation.modes.plot_neff_vs_width
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.simulation.modes.plot_coupling_vs_gap.html">
     gdsfactory.simulation.modes.plot_coupling_vs_gap
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.simulation.plot.plot_sparameters.html">
     gdsfactory.simulation.plot.plot_sparameters
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.simulation.plot.plot_imbalance2x2.html">
     gdsfactory.simulation.plot.plot_imbalance2x2
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.simulation.plot.plot_loss2x2.html">
     gdsfactory.simulation.plot.plot_loss2x2
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.simulation.get_effective_indices.html">
     gdsfactory.simulation.get_effective_indices
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.simulation.gmeep.write_sparameters_meep.html">
     gdsfactory.simulation.gmeep.write_sparameters_meep
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.simulation.gmeep.write_sparameters_meep_mpi.html">
     gdsfactory.simulation.gmeep.write_sparameters_meep_mpi
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.simulation.gmeep.write_sparameters_meep_batch.html">
     gdsfactory.simulation.gmeep.write_sparameters_meep_batch
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.simulation.gmeep.write_sparameters_grating.html">
     gdsfactory.simulation.gmeep.write_sparameters_grating
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.simulation.gmeep.write_sparameters_grating_mpi.html">
     gdsfactory.simulation.gmeep.write_sparameters_grating_mpi
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.simulation.gmeep.write_sparameters_grating_batch.html">
     gdsfactory.simulation.gmeep.write_sparameters_grating_batch
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.simulation.gtidy3d.write_sparameters.html">
     gdsfactory.simulation.gtidy3d.write_sparameters
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.simulation.gtidy3d.write_sparameters_batch.html">
     gdsfactory.simulation.gtidy3d.write_sparameters_batch
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.simulation.gtidy3d.write_sparameters_grating_coupler.html">
     gdsfactory.simulation.gtidy3d.write_sparameters_grating_coupler
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.simulation.lumerical.write_sparameters_lumerical.html">
     gdsfactory.simulation.lumerical.write_sparameters_lumerical
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.simulation.sax.read.model_from_csv.html">
     gdsfactory.simulation.sax.read.model_from_csv
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.simulation.sax.read.model_from_component.html">
     gdsfactory.simulation.sax.read.model_from_component
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.simulation.sax.plot_model.html">
     gdsfactory.simulation.sax.plot_model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.simulation.sax.models.html">
     gdsfactory.simulation.sax.models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.simulation.lumerical.interconnect.install_design_kit.html">
     gdsfactory.simulation.lumerical.interconnect.install_design_kit
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.simulation.lumerical.interconnect.add_interconnect_element.html">
     gdsfactory.simulation.lumerical.interconnect.add_interconnect_element
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.simulation.lumerical.interconnect.get_interconnect_settings.html">
     gdsfactory.simulation.lumerical.interconnect.get_interconnect_settings
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.simulation.lumerical.interconnect.send_to_interconnect.html">
     gdsfactory.simulation.lumerical.interconnect.send_to_interconnect
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.simulation.lumerical.interconnect.run_wavelength_sweep.html">
     gdsfactory.simulation.lumerical.interconnect.run_wavelength_sweep
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.simulation.lumerical.interconnect.plot_wavelength_sweep.html">
     gdsfactory.simulation.lumerical.interconnect.plot_wavelength_sweep
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../routing.html">
   Routing API
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.routing.get_route.html">
     gdsfactory.routing.get_route
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.routing.get_route_from_steps.html">
     gdsfactory.routing.get_route_from_steps
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.routing.route_quad.html">
     gdsfactory.routing.route_quad
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.routing.route_sharp.html">
     gdsfactory.routing.route_sharp
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.routing.get_bundle.html">
     gdsfactory.routing.get_bundle
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.routing.get_bundle_from_steps.html">
     gdsfactory.routing.get_bundle_from_steps
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.routing.get_bundle_path_length_match.html">
     gdsfactory.routing.get_bundle_path_length_match
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.routing.route_ports_to_side.html">
     gdsfactory.routing.route_ports_to_side
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.routing.route_south.html">
     gdsfactory.routing.route_south
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.routing.get_routes_bend180.html">
     gdsfactory.routing.get_routes_bend180
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.routing.get_routes_straight.html">
     gdsfactory.routing.get_routes_straight
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.routing.get_route_sbend.html">
     gdsfactory.routing.get_route_sbend
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.routing.get_bundle_sbend.html">
     gdsfactory.routing.get_bundle_sbend
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.routing.fanout2x2.html">
     gdsfactory.routing.fanout2x2
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.routing.fanout_component.html">
     gdsfactory.routing.fanout_component
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.routing.fanout_ports.html">
     gdsfactory.routing.fanout_ports
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.routing.add_fiber_array.add_fiber_array.html">
     gdsfactory.routing.add_fiber_array.add_fiber_array
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.routing.add_fiber_single.add_fiber_single.html">
     gdsfactory.routing.add_fiber_single.add_fiber_single
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.routing.add_electrical_pads_shortest.html">
     gdsfactory.routing.add_electrical_pads_shortest
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.routing.add_electrical_pads_top.html">
     gdsfactory.routing.add_electrical_pads_top
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../_autosummary/gdsfactory.routing.add_electrical_pads_top_dc.html">
     gdsfactory.routing.add_electrical_pads_top_dc
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../cli.html">
   Command line interface
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/gdsfactory/gdsfactory"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/gdsfactory/gdsfactory/issues/new?title=Issue%20on%20page%20%2Fnotebooks/plugins/sax/sax.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/gdsfactory/gdsfactory/edit/main/docs/notebooks/plugins/sax/sax.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../../_sources/notebooks/plugins/sax/sax.ipynb.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Scatter-dictionaries">
   Scatter
   <em>
    dictionaries
   </em>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Parametrized-Models">
   Parametrized Models
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Waveguide-model">
     Waveguide model
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Coupler-model">
     Coupler model
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#FDTD-Sparameters-model">
     FDTD Sparameters model
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Model-fit">
   Model fit
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Symmetric">
     Symmetric
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Anti-Symmetric">
     Anti-Symmetric
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Total">
     Total
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#SAX-gdsfactory-Compatibility">
   SAX gdsfactory Compatibility
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Layout-aware-Monte-Carlo">
   Layout aware Monte Carlo
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Waveguide-Model">
     Waveguide Model
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Circuit-model-with-variability">
     Circuit model with variability
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Simple-MZI">
     Simple MZI
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Compact-MZI">
     Compact MZI
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Tuning">
   Tuning
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Optimization">
   Optimization
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Hierarchical-circuits">
   Hierarchical circuits
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>SAX circuit simulator</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Scatter-dictionaries">
   Scatter
   <em>
    dictionaries
   </em>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Parametrized-Models">
   Parametrized Models
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Waveguide-model">
     Waveguide model
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Coupler-model">
     Coupler model
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#FDTD-Sparameters-model">
     FDTD Sparameters model
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Model-fit">
   Model fit
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Symmetric">
     Symmetric
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Anti-Symmetric">
     Anti-Symmetric
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Total">
     Total
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#SAX-gdsfactory-Compatibility">
   SAX gdsfactory Compatibility
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Layout-aware-Monte-Carlo">
   Layout aware Monte Carlo
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Waveguide-Model">
     Waveguide Model
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Circuit-model-with-variability">
     Circuit model with variability
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Simple-MZI">
     Simple MZI
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Compact-MZI">
     Compact MZI
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Tuning">
   Tuning
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Optimization">
   Optimization
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Hierarchical-circuits">
   Hierarchical circuits
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars and line breaks on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
    white-space: pre;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<section id="SAX-circuit-simulator">
<h1>SAX circuit simulator<a class="headerlink" href="#SAX-circuit-simulator" title="Permalink to this headline">#</a></h1>
<p><a class="reference external" href="https://flaport.github.io/sax/">SAX</a> is a circuit solver written in JAX, writing your component models in SAX enables you not only to get the function values but the gradients, this is useful for circuit optimization.</p>
<p>This tutorial has been adapted from the SAX Quick Start.</p>
<p>You can install sax with pip (read the SAX install instructions <a class="reference external" href="https://github.com/flaport/sax#installation">here</a>)</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>! pip install sax
</pre></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import gdsfactory as gf
import gdsfactory.simulation.sax as gs
import gdsfactory.simulation.modes as gm
import matplotlib.pyplot as plt
import sax

gf.config.set_plot_options(show_subports=False)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2023-01-03 02:14:09.902 | INFO     | gdsfactory.config:&lt;module&gt;:48 - Load &#39;/home/runner/work/gdsfactory/gdsfactory/gdsfactory&#39; 6.17.0
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Using MPI version 4.0, 1 processes
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2023-01-03 02:14:11.994 | INFO     | gdsfactory.simulation.gmeep:&lt;module&gt;:34 - Meep &#39;1.25.0-beta&#39; installed at [&#39;/usr/share/miniconda/envs/anaconda-client-env/lib/python3.9/site-packages/meep&#39;]
</pre></div></div>
</div>
<section id="Scatter-dictionaries">
<h2>Scatter <em>dictionaries</em><a class="headerlink" href="#Scatter-dictionaries" title="Permalink to this headline">#</a></h2>
<p>The core datastructure for specifying scatter parameters in SAX is a dictionary more specifically a dictionary which maps a port combination (2-tuple) to a scatter parameter (or an array of scatter parameters when considering multiple wavelengths for example). Such a specific dictionary mapping is called ann <code class="docutils literal notranslate"><span class="pre">SDict</span></code> in SAX (<code class="docutils literal notranslate"><span class="pre">SDict</span> <span class="pre"></span> <span class="pre">Dict[Tuple[str,str],</span> <span class="pre">float]</span></code>).</p>
<p>Dictionaries are in fact much better suited for characterizing S-parameters than, say, (jax-)numpy arrays due to the inherent sparse nature of scatter parameters. Moreover, dictionaries allow for string indexing, which makes them much more pleasant to use in this context.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>o2            o3
   \        /
    ========
   /        \
o1            o4
</pre></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>coupling = 0.5
kappa = coupling**0.5
tau = (1 - coupling) ** 0.5
coupler_dict = {
    (&quot;o1&quot;, &quot;o4&quot;): tau,
    (&quot;o4&quot;, &quot;o1&quot;): tau,
    (&quot;o1&quot;, &quot;o3&quot;): 1j * kappa,
    (&quot;o3&quot;, &quot;o1&quot;): 1j * kappa,
    (&quot;o2&quot;, &quot;o4&quot;): 1j * kappa,
    (&quot;o4&quot;, &quot;o2&quot;): 1j * kappa,
    (&quot;o2&quot;, &quot;o3&quot;): tau,
    (&quot;o3&quot;, &quot;o2&quot;): tau,
}
coupler_dict
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{(&#39;o1&#39;, &#39;o4&#39;): 0.7071067811865476,
 (&#39;o4&#39;, &#39;o1&#39;): 0.7071067811865476,
 (&#39;o1&#39;, &#39;o3&#39;): 0.7071067811865476j,
 (&#39;o3&#39;, &#39;o1&#39;): 0.7071067811865476j,
 (&#39;o2&#39;, &#39;o4&#39;): 0.7071067811865476j,
 (&#39;o4&#39;, &#39;o2&#39;): 0.7071067811865476j,
 (&#39;o2&#39;, &#39;o3&#39;): 0.7071067811865476,
 (&#39;o3&#39;, &#39;o2&#39;): 0.7071067811865476}
</pre></div></div>
</div>
<p>it can still be tedious to specify every port in the circuit manually. SAX therefore offers the <code class="docutils literal notranslate"><span class="pre">reciprocal</span></code> function, which auto-fills the reverse connection if the forward connection exist. For example:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>coupler_dict = sax.reciprocal(
    {
        (&quot;o1&quot;, &quot;o4&quot;): tau,
        (&quot;o1&quot;, &quot;o3&quot;): 1j * kappa,
        (&quot;o2&quot;, &quot;o4&quot;): 1j * kappa,
        (&quot;o2&quot;, &quot;o3&quot;): tau,
    }
)

coupler_dict
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{(&#39;o1&#39;, &#39;o4&#39;): 0.7071067811865476,
 (&#39;o1&#39;, &#39;o3&#39;): 0.7071067811865476j,
 (&#39;o2&#39;, &#39;o4&#39;): 0.7071067811865476j,
 (&#39;o2&#39;, &#39;o3&#39;): 0.7071067811865476,
 (&#39;o4&#39;, &#39;o1&#39;): 0.7071067811865476,
 (&#39;o3&#39;, &#39;o1&#39;): 0.7071067811865476j,
 (&#39;o4&#39;, &#39;o2&#39;): 0.7071067811865476j,
 (&#39;o3&#39;, &#39;o2&#39;): 0.7071067811865476}
</pre></div></div>
</div>
</section>
<section id="Parametrized-Models">
<h2>Parametrized Models<a class="headerlink" href="#Parametrized-Models" title="Permalink to this headline">#</a></h2>
<p>Constructing such an <code class="docutils literal notranslate"><span class="pre">SDict</span></code> is easy, however, usually were more interested in having parametrized models for our components. To parametrize the coupler <code class="docutils literal notranslate"><span class="pre">SDict</span></code>, just wrap it in a function to obtain a SAX <code class="docutils literal notranslate"><span class="pre">Model</span></code>, which is a keyword-only function mapping to an <code class="docutils literal notranslate"><span class="pre">SDict</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def coupler(coupling=0.5) -&gt; sax.SDict:
    kappa = coupling**0.5
    tau = (1 - coupling) ** 0.5
    return sax.reciprocal(
        {
            (&quot;o1&quot;, &quot;o4&quot;): tau,
            (&quot;o1&quot;, &quot;o3&quot;): 1j * kappa,
            (&quot;o2&quot;, &quot;o4&quot;): 1j * kappa,
            (&quot;o2&quot;, &quot;o3&quot;): tau,
        }
    )


coupler(coupling=0.3)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{(&#39;o1&#39;, &#39;o4&#39;): 0.8366600265340756,
 (&#39;o1&#39;, &#39;o3&#39;): 0.5477225575051661j,
 (&#39;o2&#39;, &#39;o4&#39;): 0.5477225575051661j,
 (&#39;o2&#39;, &#39;o3&#39;): 0.8366600265340756,
 (&#39;o4&#39;, &#39;o1&#39;): 0.8366600265340756,
 (&#39;o3&#39;, &#39;o1&#39;): 0.5477225575051661j,
 (&#39;o4&#39;, &#39;o2&#39;): 0.5477225575051661j,
 (&#39;o3&#39;, &#39;o2&#39;): 0.8366600265340756}
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def waveguide(wl=1.55, wl0=1.55, neff=2.34, ng=3.4, length=10.0, loss=0.0) -&gt; sax.SDict:
    dwl = wl - wl0
    dneff_dwl = (ng - neff) / wl0
    neff = neff - dwl * dneff_dwl
    phase = 2 * jnp.pi * neff * length / wl
    transmission = 10 ** (-loss * length / 20) * jnp.exp(1j * phase)
    return sax.reciprocal(
        {
            (&quot;o1&quot;, &quot;o2&quot;): transmission,
        }
    )
</pre></div>
</div>
</div>
<section id="Waveguide-model">
<h3>Waveguide model<a class="headerlink" href="#Waveguide-model" title="Permalink to this headline">#</a></h3>
<p>You can create a dispersive waveguide model in SAX.</p>
<p>Lets compute the effective index <code class="docutils literal notranslate"><span class="pre">neff</span></code> and group index <code class="docutils literal notranslate"><span class="pre">ng</span></code> for a 1550nm 500nm straight waveguide</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>m = gm.find_mode_dispersion(wavelength=1.55)
print(m.neff, m.ng)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #7fbfbf; text-decoration-color: #7fbfbf">[02:14:12] </span><span style="color: #000080; text-decoration-color: #000080">INFO    </span> Using client version: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.8</span>.<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>                                                     <a href="file:///usr/share/miniconda/envs/anaconda-client-env/lib/python3.9/site-packages/tidy3d/__init__.py" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">__init__.py</span></a><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">:</span><a href="file:///usr/share/miniconda/envs/anaconda-client-env/lib/python3.9/site-packages/tidy3d/__init__.py#112" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">112</span></a>
</pre></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2023-01-03 02:14:12.649 | INFO     | gdsfactory.simulation.gtidy3d:&lt;module&gt;:54 - Tidy3d &#39;1.8.1&#39; installed at [&#39;/usr/share/miniconda/envs/anaconda-client-env/lib/python3.9/site-packages/tidy3d&#39;]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2.355373323575021 4.270367208601266
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>straight_sc = gf.partial(gs.models.straight, neff=m.neff, ng=m.ng)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>gs.plot_model(straight_sc)
plt.ylim(-1, 1)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span><span style="color: #000080; text-decoration-color: #000080">INFO    </span> Unable to initialize backend <span style="color: #008000; text-decoration-color: #008000">'tpu_driver'</span>: NOT_FOUND: Unable to find driver   <a href="file:///usr/share/miniconda/envs/anaconda-client-env/lib/python3.9/site-packages/jax/_src/lib/xla_bridge.py" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">xla_bridge.py</span></a><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">:</span><a href="file:///usr/share/miniconda/envs/anaconda-client-env/lib/python3.9/site-packages/jax/_src/lib/xla_bridge.py#355" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">355</span></a>
<span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span>         in registry given worker:                                                     <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">                 </span>
</pre></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span><span style="color: #000080; text-decoration-color: #000080">INFO    </span> Unable to initialize backend <span style="color: #008000; text-decoration-color: #008000">'cuda'</span>: module <span style="color: #008000; text-decoration-color: #008000">'jaxlib.xla_extension'</span> has no     <a href="file:///usr/share/miniconda/envs/anaconda-client-env/lib/python3.9/site-packages/jax/_src/lib/xla_bridge.py" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">xla_bridge.py</span></a><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">:</span><a href="file:///usr/share/miniconda/envs/anaconda-client-env/lib/python3.9/site-packages/jax/_src/lib/xla_bridge.py#355" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">355</span></a>
<span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span>         attribute <span style="color: #008000; text-decoration-color: #008000">'GpuAllocatorConfig'</span>                                                <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">                 </span>
</pre></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span><span style="color: #000080; text-decoration-color: #000080">INFO    </span> Unable to initialize backend <span style="color: #008000; text-decoration-color: #008000">'rocm'</span>: module <span style="color: #008000; text-decoration-color: #008000">'jaxlib.xla_extension'</span> has no     <a href="file:///usr/share/miniconda/envs/anaconda-client-env/lib/python3.9/site-packages/jax/_src/lib/xla_bridge.py" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">xla_bridge.py</span></a><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">:</span><a href="file:///usr/share/miniconda/envs/anaconda-client-env/lib/python3.9/site-packages/jax/_src/lib/xla_bridge.py#355" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">355</span></a>
<span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span>         attribute <span style="color: #008000; text-decoration-color: #008000">'GpuAllocatorConfig'</span>                                                <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">                 </span>
</pre></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span><span style="color: #000080; text-decoration-color: #000080">INFO    </span> Unable to initialize backend <span style="color: #008000; text-decoration-color: #008000">'tpu'</span>: INVALID_ARGUMENT: TpuPlatform is not      <a href="file:///usr/share/miniconda/envs/anaconda-client-env/lib/python3.9/site-packages/jax/_src/lib/xla_bridge.py" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">xla_bridge.py</span></a><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">:</span><a href="file:///usr/share/miniconda/envs/anaconda-client-env/lib/python3.9/site-packages/jax/_src/lib/xla_bridge.py#355" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">355</span></a>
<span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span>         available.                                                                    <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">                 </span>
</pre></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span><span style="color: #000080; text-decoration-color: #000080">INFO    </span> Unable to initialize backend <span style="color: #008000; text-decoration-color: #008000">'plugin'</span>: xla_extension has no attributes named  <a href="file:///usr/share/miniconda/envs/anaconda-client-env/lib/python3.9/site-packages/jax/_src/lib/xla_bridge.py" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">xla_bridge.py</span></a><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">:</span><a href="file:///usr/share/miniconda/envs/anaconda-client-env/lib/python3.9/site-packages/jax/_src/lib/xla_bridge.py#355" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">355</span></a>
<span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span>         get_plugin_device_client. Compile TensorFlow with                             <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">                 </span>
<span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span>         <span style="color: #800080; text-decoration-color: #800080">//tensorflow/compiler/xla/</span><span style="color: #ff00ff; text-decoration-color: #ff00ff">python</span>:enable_plugin_device set to true <span style="font-weight: bold">(</span>defaults   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">                 </span>
<span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span>         to false<span style="font-weight: bold">)</span> to enable this.                                                     <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">                 </span>
</pre></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span><span style="color: #800000; text-decoration-color: #800000">WARNING </span> No GPU/TPU found, falling back to CPU. <span style="font-weight: bold">(</span>Set <span style="color: #808000; text-decoration-color: #808000">TF_CPP_MIN_LOG_LEVEL</span>=<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span> and rerun  <a href="file:///usr/share/miniconda/envs/anaconda-client-env/lib/python3.9/site-packages/jax/_src/lib/xla_bridge.py" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">xla_bridge.py</span></a><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">:</span><a href="file:///usr/share/miniconda/envs/anaconda-client-env/lib/python3.9/site-packages/jax/_src/lib/xla_bridge.py#362" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">362</span></a>
<span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span>         for more info.<span style="font-weight: bold">)</span>                                                               <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">                 </span>
</pre></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-1.0</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.0</span><span style="font-weight: bold">)</span>
</pre></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_plugins_sax_sax_13_7.png" src="../../../_images/notebooks_plugins_sax_sax_13_7.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>gs.plot_model(straight_sc, phase=True)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_plugins_sax_sax_14_0.png" src="../../../_images/notebooks_plugins_sax_sax_14_0.png" />
</div>
</div>
</section>
<section id="Coupler-model">
<h3>Coupler model<a class="headerlink" href="#Coupler-model" title="Permalink to this headline">#</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>gm.find_coupling_vs_gap?
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>df = gm.find_coupling_vs_gap()
df
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "4e72f52e9ca642168bb3e1e624c071e8"}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gap</th>
      <th>ne</th>
      <th>no</th>
      <th>lc</th>
      <th>dn</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.200000</td>
      <td>2.457893</td>
      <td>2.437607</td>
      <td>38.202268</td>
      <td>0.020287</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.218182</td>
      <td>2.459030</td>
      <td>2.441121</td>
      <td>43.276286</td>
      <td>0.017908</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.236364</td>
      <td>2.452194</td>
      <td>2.437659</td>
      <td>53.319585</td>
      <td>0.014535</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.254545</td>
      <td>2.451945</td>
      <td>2.439549</td>
      <td>62.518874</td>
      <td>0.012396</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.272727</td>
      <td>2.451249</td>
      <td>2.441058</td>
      <td>76.046705</td>
      <td>0.010191</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.290909</td>
      <td>2.451496</td>
      <td>2.442325</td>
      <td>84.505360</td>
      <td>0.009171</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.309091</td>
      <td>2.449447</td>
      <td>2.441517</td>
      <td>97.724262</td>
      <td>0.007930</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.327273</td>
      <td>2.447256</td>
      <td>2.440698</td>
      <td>118.172655</td>
      <td>0.006558</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.345455</td>
      <td>2.451724</td>
      <td>2.446248</td>
      <td>141.519584</td>
      <td>0.005476</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.363636</td>
      <td>2.451128</td>
      <td>2.446210</td>
      <td>157.598147</td>
      <td>0.004918</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.381818</td>
      <td>2.445594</td>
      <td>2.441408</td>
      <td>185.125114</td>
      <td>0.004186</td>
    </tr>
    <tr>
      <th>11</th>
      <td>0.400000</td>
      <td>2.445134</td>
      <td>2.441678</td>
      <td>224.257067</td>
      <td>0.003456</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>For a 200nm gap the effective index difference <code class="docutils literal notranslate"><span class="pre">dn</span></code> is <code class="docutils literal notranslate"><span class="pre">0.02</span></code>, which means that there is 100% power coupling over 38.2um</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>coupler_sc = gf.partial(gs.models.coupler, dn=0.02, length=0, coupling0=0)
gs.plot_model(coupler_sc)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_plugins_sax_sax_19_0.png" src="../../../_images/notebooks_plugins_sax_sax_19_0.png" />
</div>
</div>
<p>If we ignore the coupling from the bend <code class="docutils literal notranslate"><span class="pre">coupling0</span> <span class="pre">=</span> <span class="pre">0</span></code> we know that for a 3dB coupling we need half of the <code class="docutils literal notranslate"><span class="pre">lc</span></code> length, which is the length needed to coupler <code class="docutils literal notranslate"><span class="pre">100%</span></code> of power.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>coupler_sc = gf.partial(gs.models.coupler, dn=0.02, length=38.2 / 2, coupling0=0)
gs.plot_model(coupler_sc)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_plugins_sax_sax_21_0.png" src="../../../_images/notebooks_plugins_sax_sax_21_0.png" />
</div>
</div>
</section>
<section id="FDTD-Sparameters-model">
<h3>FDTD Sparameters model<a class="headerlink" href="#FDTD-Sparameters-model" title="Permalink to this headline">#</a></h3>
<p>You can also fit a model from Sparameter FDTD simulation data.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from gdsfactory.simulation.get_sparameters_path import get_sparameters_path_lumerical

filepath = get_sparameters_path_lumerical(gf.c.mmi1x2)
mmi1x2 = gs.read.model_from_npz(filepath=filepath)
gs.plot_model(mmi1x2)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_plugins_sax_sax_23_0.png" src="../../../_images/notebooks_plugins_sax_sax_23_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>gs.plot_model(mmi1x2, ports2=(&quot;o2&quot;, &quot;o3&quot;))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_plugins_sax_sax_24_0.png" src="../../../_images/notebooks_plugins_sax_sax_24_0.png" />
</div>
</div>
</section>
</section>
<section id="Model-fit">
<h2>Model fit<a class="headerlink" href="#Model-fit" title="Permalink to this headline">#</a></h2>
<p>You can fit a sax model to Sparameter FDTD simulation data.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import jax
import jax.numpy as jnp
import jax.example_libraries.optimizers as opt
import matplotlib.pyplot as plt

import gdsfactory as gf
import gdsfactory.simulation.modes as gm
import gdsfactory.simulation.sax as gs
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>coupler_fdtd = gs.read.model_from_csv(
    filepath=gf.config.sparameters_path / &quot;coupler&quot; / &quot;coupler_G224n_L20_S220.csv&quot;,
    xkey=&quot;wavelength_nm&quot;,
    prefix=&quot;S&quot;,
    xunits=1e-3,
)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>gs.plot_model(coupler_fdtd)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_plugins_sax_sax_28_0.png" src="../../../_images/notebooks_plugins_sax_sax_28_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># lumerical simulation (different coupler)
coupler_fdtd = gs.read.model_from_csv(
    filepath=gf.config.sparameters_path / &quot;coupler_057254c0_00cc8908.csv&quot;,
)
gs.plot_model(coupler_fdtd)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_plugins_sax_sax_29_0.png" src="../../../_images/notebooks_plugins_sax_sax_29_0.png" />
</div>
</div>
<p>Lets fit the coupler spectrum with a linear regression <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> fit</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import sax
import gdsfactory as gf
import gdsfactory.simulation.sax as gs
import jax
import jax.numpy as jnp
import matplotlib.pyplot as plt
from scipy.constants import c
from sklearn.linear_model import LinearRegression
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>f = jnp.linspace(c / 1.0e-6, c / 2.0e-6, 500) * 1e-12  # THz
wl = c / (f * 1e12) * 1e6  # um

filepath = gf.config.sparameters_path / &quot;coupler&quot; / &quot;coupler_G224n_L20_S220.csv&quot;
coupler_fdtd = gs.read.model_from_csv(
    filepath, xkey=&quot;wavelength_nm&quot;, prefix=&quot;S&quot;, xunits=1e-3
)
sd = coupler_fdtd(wl=wl)

k = sd[&quot;o1&quot;, &quot;o3&quot;]
t = sd[&quot;o1&quot;, &quot;o4&quot;]
s = t + k
a = t - k
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/usr/share/miniconda/envs/anaconda-client-env/lib/python3.9/site-packages/numpy/core/getlimits.py:518: UserWarning: The value of the smallest subnormal for &lt;class &#39;numpy.float32&#39;&gt; type is zero.
  setattr(self, word, getattr(machar, word).flat[0])
/usr/share/miniconda/envs/anaconda-client-env/lib/python3.9/site-packages/numpy/core/getlimits.py:89: UserWarning: The value of the smallest subnormal for &lt;class &#39;numpy.float32&#39;&gt; type is zero.
  return self._float_to_str(self.smallest_subnormal)
</pre></div></div>
</div>
<p>Lets fit the symmetric (t+k) and antisymmetric (t-k) transmission</p>
<section id="Symmetric">
<h3>Symmetric<a class="headerlink" href="#Symmetric" title="Permalink to this headline">#</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>plt.plot(wl, jnp.abs(s))
plt.grid(True)
plt.xlabel(&quot;Frequency [THz]&quot;)
plt.ylabel(&quot;Transmission&quot;)
plt.title(&quot;symmetric (transmission + coupling)&quot;)
plt.legend()
plt.show()
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #7fbfbf; text-decoration-color: #7fbfbf">[02:14:28] </span><span style="color: #800000; text-decoration-color: #800000">WARNING </span> No artists with labels found to put in legend.  Note that artists whose label    <a href="file:///usr/share/miniconda/envs/anaconda-client-env/lib/python3.9/site-packages/matplotlib/legend.py" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">legend.py</span></a><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">:</span><a href="file:///usr/share/miniconda/envs/anaconda-client-env/lib/python3.9/site-packages/matplotlib/legend.py#1236" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1236</span></a>
<span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span>         start with an underscore are ignored when <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">legend</span><span style="font-weight: bold">()</span> is called with no argument.   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">              </span>
</pre></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_plugins_sax_sax_34_1.png" src="../../../_images/notebooks_plugins_sax_sax_34_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>plt.plot(wl, jnp.abs(a))
plt.grid(True)
plt.xlabel(&quot;Frequency [THz]&quot;)
plt.ylabel(&quot;Transmission&quot;)
plt.title(&quot;anti-symmetric (transmission - coupling)&quot;)
plt.legend()
plt.show()
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span><span style="color: #800000; text-decoration-color: #800000">WARNING </span> No artists with labels found to put in legend.  Note that artists whose label    <a href="file:///usr/share/miniconda/envs/anaconda-client-env/lib/python3.9/site-packages/matplotlib/legend.py" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">legend.py</span></a><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">:</span><a href="file:///usr/share/miniconda/envs/anaconda-client-env/lib/python3.9/site-packages/matplotlib/legend.py#1236" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1236</span></a>
<span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span>         start with an underscore are ignored when <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">legend</span><span style="font-weight: bold">()</span> is called with no argument.   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">              </span>
</pre></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_plugins_sax_sax_35_1.png" src="../../../_images/notebooks_plugins_sax_sax_35_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>r = LinearRegression()
fX = lambda x, _order=8: x[:, None] ** (
    jnp.arange(_order)[None, :]
)  # artificially create more &#39;features&#39; (wl**2, wl**3, wl**4, ...)
X = fX(wl)
r.fit(X, jnp.abs(s))
asm, bsm = r.coef_, r.intercept_
fsm = lambda x: fX(x) @ asm + bsm  # fit symmetric module fiir

plt.plot(wl, jnp.abs(s))
plt.plot(wl, fsm(wl))
plt.grid(True)
plt.xlabel(&quot;Frequency [THz]&quot;)
plt.ylabel(&quot;Transmission&quot;)
plt.legend()
plt.show()
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #7fbfbf; text-decoration-color: #7fbfbf">[02:14:29] </span><span style="color: #800000; text-decoration-color: #800000">WARNING </span> No artists with labels found to put in legend.  Note that artists whose label    <a href="file:///usr/share/miniconda/envs/anaconda-client-env/lib/python3.9/site-packages/matplotlib/legend.py" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">legend.py</span></a><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">:</span><a href="file:///usr/share/miniconda/envs/anaconda-client-env/lib/python3.9/site-packages/matplotlib/legend.py#1236" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1236</span></a>
<span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span>         start with an underscore are ignored when <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">legend</span><span style="font-weight: bold">()</span> is called with no argument.   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">              </span>
</pre></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_plugins_sax_sax_36_1.png" src="../../../_images/notebooks_plugins_sax_sax_36_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>r = LinearRegression()
r.fit(X, jnp.unwrap(jnp.angle(s)))
asp, bsp = r.coef_, r.intercept_
fsp = lambda x: fX(x) @ asp + bsp  # fit symmetric phase

plt.plot(wl, jnp.unwrap(jnp.angle(s)))
plt.plot(wl, fsp(wl))
plt.grid(True)
plt.xlabel(&quot;Frequency [THz]&quot;)
plt.ylabel(&quot;Angle [rad]&quot;)
plt.legend()
plt.show()
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span><span style="color: #800000; text-decoration-color: #800000">WARNING </span> No artists with labels found to put in legend.  Note that artists whose label    <a href="file:///usr/share/miniconda/envs/anaconda-client-env/lib/python3.9/site-packages/matplotlib/legend.py" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">legend.py</span></a><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">:</span><a href="file:///usr/share/miniconda/envs/anaconda-client-env/lib/python3.9/site-packages/matplotlib/legend.py#1236" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1236</span></a>
<span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span>         start with an underscore are ignored when <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">legend</span><span style="font-weight: bold">()</span> is called with no argument.   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">              </span>
</pre></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_plugins_sax_sax_37_1.png" src="../../../_images/notebooks_plugins_sax_sax_37_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>fs = lambda x: fsm(x) * jnp.exp(1j * fsp(x))
</pre></div>
</div>
</div>
<p>Lets fit the symmetric (t+k) and antisymmetric (t-k) transmission</p>
</section>
<section id="Anti-Symmetric">
<h3>Anti-Symmetric<a class="headerlink" href="#Anti-Symmetric" title="Permalink to this headline">#</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>r = LinearRegression()
r.fit(X, jnp.abs(a))
aam, bam = r.coef_, r.intercept_
fam = lambda x: fX(x) @ aam + bam

plt.plot(wl, jnp.abs(a))
plt.plot(wl, fam(wl))
plt.grid(True)
plt.xlabel(&quot;Frequency [THz]&quot;)
plt.ylabel(&quot;Transmission&quot;)
plt.legend()
plt.show()
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span><span style="color: #800000; text-decoration-color: #800000">WARNING </span> No artists with labels found to put in legend.  Note that artists whose label    <a href="file:///usr/share/miniconda/envs/anaconda-client-env/lib/python3.9/site-packages/matplotlib/legend.py" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">legend.py</span></a><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">:</span><a href="file:///usr/share/miniconda/envs/anaconda-client-env/lib/python3.9/site-packages/matplotlib/legend.py#1236" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1236</span></a>
<span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span>         start with an underscore are ignored when <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">legend</span><span style="font-weight: bold">()</span> is called with no argument.   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">              </span>
</pre></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_plugins_sax_sax_40_1.png" src="../../../_images/notebooks_plugins_sax_sax_40_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>r = LinearRegression()
r.fit(X, jnp.unwrap(jnp.angle(a)))
aap, bap = r.coef_, r.intercept_
fap = lambda x: fX(x) @ aap + bap

plt.plot(wl, jnp.unwrap(jnp.angle(a)))
plt.plot(wl, fap(wl))
plt.grid(True)
plt.xlabel(&quot;Frequency [THz]&quot;)
plt.ylabel(&quot;Angle [rad]&quot;)
plt.legend()
plt.show()
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span><span style="color: #800000; text-decoration-color: #800000">WARNING </span> No artists with labels found to put in legend.  Note that artists whose label    <a href="file:///usr/share/miniconda/envs/anaconda-client-env/lib/python3.9/site-packages/matplotlib/legend.py" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">legend.py</span></a><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">:</span><a href="file:///usr/share/miniconda/envs/anaconda-client-env/lib/python3.9/site-packages/matplotlib/legend.py#1236" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1236</span></a>
<span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span>         start with an underscore are ignored when <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">legend</span><span style="font-weight: bold">()</span> is called with no argument.   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">              </span>
</pre></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_plugins_sax_sax_41_1.png" src="../../../_images/notebooks_plugins_sax_sax_41_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>fa = lambda x: fam(x) * jnp.exp(1j * fap(x))
</pre></div>
</div>
</div>
</section>
<section id="Total">
<h3>Total<a class="headerlink" href="#Total" title="Permalink to this headline">#</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>t_ = 0.5 * (fs(wl) + fa(wl))

plt.plot(wl, jnp.abs(t))
plt.plot(wl, jnp.abs(t_))
plt.xlabel(&quot;Frequency [THz]&quot;)
plt.ylabel(&quot;Transmission&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_plugins_sax_sax_44_0.png" src="../../../_images/notebooks_plugins_sax_sax_44_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>k_ = 0.5 * (fs(wl) - fa(wl))

plt.plot(wl, jnp.abs(k))
plt.plot(wl, jnp.abs(k_))
plt.xlabel(&quot;Frequency [THz]&quot;)
plt.ylabel(&quot;Coupling&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_plugins_sax_sax_45_0.png" src="../../../_images/notebooks_plugins_sax_sax_45_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>@jax.jit
def coupler(wl=1.5):
    wl = jnp.asarray(wl)
    wl_shape = wl.shape
    wl = wl.ravel()
    t = (0.5 * (fs(wl) + fa(wl))).reshape(*wl_shape)
    k = (0.5 * (fs(wl) - fa(wl))).reshape(*wl_shape)
    sdict = {
        (&quot;o1&quot;, &quot;o4&quot;): t,
        (&quot;o1&quot;, &quot;o3&quot;): k,
        (&quot;o2&quot;, &quot;o3&quot;): k,
        (&quot;o2&quot;, &quot;o4&quot;): t,
    }
    return sax.reciprocal(sdict)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>f = jnp.linspace(c / 1.0e-6, c / 2.0e-6, 500) * 1e-12  # THz
wl = c / (f * 1e12) * 1e6  # um

filepath = gf.config.sparameters_path / &quot;coupler&quot; / &quot;coupler_G224n_L20_S220.csv&quot;
coupler_fdtd = gs.read.model_from_csv(
    filepath, xkey=&quot;wavelength_nm&quot;, prefix=&quot;S&quot;, xunits=1e-3
)
sd = coupler_fdtd(wl=wl)
sd_ = coupler(wl=wl)

T = jnp.abs(sd[&quot;o1&quot;, &quot;o4&quot;]) ** 2
K = jnp.abs(sd[&quot;o1&quot;, &quot;o3&quot;]) ** 2
T_ = jnp.abs(sd_[&quot;o1&quot;, &quot;o4&quot;]) ** 2
K_ = jnp.abs(sd_[&quot;o1&quot;, &quot;o3&quot;]) ** 2
dP = jnp.unwrap(jnp.angle(sd[&quot;o1&quot;, &quot;o3&quot;]) - jnp.angle(sd[&quot;o1&quot;, &quot;o4&quot;]))
dP_ = jnp.unwrap(jnp.angle(sd_[&quot;o1&quot;, &quot;o3&quot;]) - jnp.angle(sd_[&quot;o1&quot;, &quot;o4&quot;]))

plt.figure(figsize=(12, 3))
plt.plot(wl, T, label=&quot;T (fdtd)&quot;, c=&quot;C0&quot;, ls=&quot;:&quot;, lw=&quot;6&quot;)
plt.plot(wl, T_, label=&quot;T (model)&quot;, c=&quot;C0&quot;)

plt.plot(wl, K, label=&quot;K (fdtd)&quot;, c=&quot;C1&quot;, ls=&quot;:&quot;, lw=&quot;6&quot;)
plt.plot(wl, K_, label=&quot;K (model)&quot;, c=&quot;C1&quot;)

plt.ylim(-0.05, 1.05)
plt.grid(True)

plt.twinx()
plt.plot(wl, dP, label=&quot; (fdtd)&quot;, color=&quot;C2&quot;, ls=&quot;:&quot;, lw=&quot;6&quot;)
plt.plot(wl, dP_, label=&quot; (model)&quot;, color=&quot;C2&quot;)

plt.xlabel(&quot;Frequency [THz]&quot;)
plt.ylabel(&quot;Transmission&quot;)
plt.figlegend(bbox_to_anchor=(1.08, 0.9))
plt.savefig(&quot;fdtd_vs_model.png&quot;, bbox_inches=&quot;tight&quot;)
plt.show()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_plugins_sax_sax_47_0.png" src="../../../_images/notebooks_plugins_sax_sax_47_0.png" />
</div>
</div>
</section>
</section>
<section id="SAX-gdsfactory-Compatibility">
<h2>SAX gdsfactory Compatibility<a class="headerlink" href="#SAX-gdsfactory-Compatibility" title="Permalink to this headline">#</a></h2>
<blockquote>
<div><p>From Layout to Circuit Model</p>
</div></blockquote>
<p>If you define your SAX S parameter models for your components, you can directly simulate your circuits from gdsfactory</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import matplotlib.pyplot as plt
import numpy as np
import jax.numpy as jnp
from omegaconf import OmegaConf
import sax
from pprint import pprint

import gdsfactory as gf
from gdsfactory.get_netlist import get_netlist as _get_netlist
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>mzi = gf.components.mzi(delta_length=10)
mzi
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_plugins_sax_sax_50_0.png" src="../../../_images/notebooks_plugins_sax_sax_50_0.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_plugins_sax_sax_50_1.png" src="../../../_images/notebooks_plugins_sax_sax_50_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
mzi_delta_length10: uid bab882fd, ports ['o1', 'o2'], references ['bend_euler_1', 'bend_euler_2', 'bend_euler_3', 'bend_euler_4', 'bend_euler_5', 'bend_euler_6', 'straight_5', 'straight_6', 'straight_7', 'bend_euler_7', 'bend_euler_8', 'straight_8', 'straight_9', 'straight_10', 'sytl', 'syl', 'sxt', 'sxb', 'cp1', 'cp2'], 0 polygons</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>netlist = mzi.get_netlist()
pprint(netlist[&quot;connections&quot;])
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;bend_euler_1,o1&#39;: &#39;cp1,o3&#39;,
 &#39;bend_euler_1,o2&#39;: &#39;syl,o1&#39;,
 &#39;bend_euler_2,o1&#39;: &#39;syl,o2&#39;,
 &#39;bend_euler_2,o2&#39;: &#39;sxb,o1&#39;,
 &#39;bend_euler_3,o1&#39;: &#39;cp1,o2&#39;,
 &#39;bend_euler_3,o2&#39;: &#39;sytl,o1&#39;,
 &#39;bend_euler_4,o1&#39;: &#39;sxt,o1&#39;,
 &#39;bend_euler_4,o2&#39;: &#39;sytl,o2&#39;,
 &#39;bend_euler_5,o1&#39;: &#39;straight_5,o2&#39;,
 &#39;bend_euler_5,o2&#39;: &#39;straight_6,o1&#39;,
 &#39;bend_euler_6,o1&#39;: &#39;straight_6,o2&#39;,
 &#39;bend_euler_6,o2&#39;: &#39;straight_7,o1&#39;,
 &#39;bend_euler_7,o1&#39;: &#39;straight_8,o2&#39;,
 &#39;bend_euler_7,o2&#39;: &#39;straight_9,o1&#39;,
 &#39;bend_euler_8,o1&#39;: &#39;straight_9,o2&#39;,
 &#39;bend_euler_8,o2&#39;: &#39;straight_10,o1&#39;,
 &#39;cp2,o2&#39;: &#39;straight_7,o2&#39;,
 &#39;cp2,o3&#39;: &#39;straight_10,o2&#39;,
 &#39;straight_5,o1&#39;: &#39;sxt,o2&#39;,
 &#39;straight_8,o1&#39;: &#39;sxb,o2&#39;}
</pre></div></div>
</div>
<p>The netlist has three different components:</p>
<ol class="arabic simple">
<li><p>straight</p></li>
<li><p>mmi1x2</p></li>
<li><p>bend_euler</p></li>
</ol>
<p>You need models for each subcomponents to simulate the Component.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def straight(wl=1.5, length=10.0, neff=2.4) -&gt; sax.SDict:
    wl0 = 1.5  # center wavelength for which the waveguide model is defined
    return sax.reciprocal({(&quot;o1&quot;, &quot;o2&quot;): jnp.exp(2j * jnp.pi * neff * length / wl)})


def mmi1x2():
    &quot;&quot;&quot;Assumes a perfect 1x2 splitter&quot;&quot;&quot;
    return sax.reciprocal(
        {
            (&quot;o1&quot;, &quot;o2&quot;): 0.5**0.5,
            (&quot;o1&quot;, &quot;o3&quot;): 0.5**0.5,
        }
    )


def bend_euler(wl=1.5, length=20.0):
    &quot;&quot;&quot; &quot;Let&#39;s assume a reduced transmission for the euler bend compared to a straight&quot;&quot;&quot;
    return {k: 0.99 * v for k, v in straight(wl=wl, length=length).items()}


models = {
    &quot;bend_euler&quot;: bend_euler,
    &quot;mmi1x2&quot;: mmi1x2,
    &quot;straight&quot;: straight,
}
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>circuit, _ = sax.circuit(netlist=netlist, models=models)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>wl = np.linspace(1.5, 1.6)
S = circuit(wl=wl)

plt.figure(figsize=(14, 4))
plt.title(&quot;MZI&quot;)
plt.plot(1e3 * wl, jnp.abs(S[&quot;o1&quot;, &quot;o2&quot;]) ** 2)
plt.xlabel(&quot; [nm]&quot;)
plt.ylabel(&quot;T&quot;)
plt.grid(True)
plt.show()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_plugins_sax_sax_55_0.png" src="../../../_images/notebooks_plugins_sax_sax_55_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>mzi = gf.components.mzi(delta_length=20)  # Double the length, reduces FSR by 1/2
mzi
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_plugins_sax_sax_56_0.png" src="../../../_images/notebooks_plugins_sax_sax_56_0.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_plugins_sax_sax_56_1.png" src="../../../_images/notebooks_plugins_sax_sax_56_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
mzi_delta_length20: uid 30486cfb, ports ['o1', 'o2'], references ['bend_euler_1', 'bend_euler_2', 'bend_euler_3', 'bend_euler_4', 'bend_euler_5', 'bend_euler_6', 'straight_5', 'straight_6', 'straight_7', 'bend_euler_7', 'bend_euler_8', 'straight_8', 'straight_9', 'straight_10', 'sytl', 'syl', 'sxt', 'sxb', 'cp1', 'cp2'], 0 polygons</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>circuit, _ = sax.circuit(netlist=mzi.get_netlist(), models=models)

wl = np.linspace(1.5, 1.6, 256)
S = circuit(wl=wl)

plt.figure(figsize=(14, 4))
plt.title(&quot;MZI&quot;)
plt.plot(1e3 * wl, jnp.abs(S[&quot;o1&quot;, &quot;o2&quot;]) ** 2)
plt.xlabel(&quot; [nm]&quot;)
plt.ylabel(&quot;T&quot;)
plt.grid(True)
plt.show()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_plugins_sax_sax_57_0.png" src="../../../_images/notebooks_plugins_sax_sax_57_0.png" />
</div>
</div>
</section>
<section id="Layout-aware-Monte-Carlo">
<h2>Layout aware Monte Carlo<a class="headerlink" href="#Layout-aware-Monte-Carlo" title="Permalink to this headline">#</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import itertools
import sys
from functools import partial
from typing import List

import gdsfactory as gf
import jax
import jax.example_libraries.optimizers as opt
import jax.numpy as jnp
import matplotlib.pyplot as plt
import numpy as np
import sax
from numpy.fft import fft2, fftfreq, fftshift, ifft2
from tqdm.notebook import tqdm, trange
</pre></div>
</div>
</div>
<section id="Waveguide-Model">
<h3>Waveguide Model<a class="headerlink" href="#Waveguide-Model" title="Permalink to this headline">#</a></h3>
<p>The waveguide model is not very good (it just has 100% transmission and no phase). You can fix the phase calculation. To do this, you need to find the effective index of the waveguide in relation to its parameters. You can use MPB mode solver to obtain the waveguide parameters from the waveguide modes thanks to <code class="docutils literal notranslate"><span class="pre">find_modes_waveguide</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def silicon_index(wl):
    &quot;&quot;&quot;a rudimentary silicon refractive index model&quot;&quot;&quot;
    a, b = 0.2411478522088102, 3.3229394315868976
    return a / wl + b
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from gdsfactory.simulation.modes import find_modes_waveguide

wavelengths = np.linspace(1.5, 1.6, 10)
widths = np.linspace(0.4, 0.6, 5)

wavelengths, widths = np.mgrid[1.5:1.6:10j, 0.4:0.6:5j]
neffs = np.zeros_like(wavelengths)
neffs_ = neffs.ravel()

for i, (wl, w) in enumerate(zip(tqdm(wavelengths.ravel()), widths.ravel())):
    modes = find_modes_waveguide(
        wavelength=wl,
        wg_width=w,
        mode_number=1,
        wg_thickness=0.22,
        slab_thickness=0.0,
        ncore=silicon_index(wl),
        nclad=1.4,
    )
    neffs_[i] = modes[1].neff
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "edb36127b12945288d5b5b21d6725d4c"}</script></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def visualize_mode(mode, field):
    field, comp = list(field)
    idx = [&quot;x&quot;, &quot;y&quot;, &quot;z&quot;].index(comp)
    x, y = getattr(mode, &quot;y&quot;), getattr(mode, &quot;z&quot;)
    Y, X = np.meshgrid(y, x)
    mode = np.abs(getattr(mode, field)[..., 0, idx]) ** 2
    plt.contour(
        X, Y, mode, cmap=&quot;inferno&quot;, levels=np.linspace(mode.min(), mode.max(), 8)
    )
    plt.colorbar(label=&quot;mode&quot;)
    plt.grid(True, alpha=0.4)
    plt.xlim(X.min(), X.max())
    plt.ylim(Y.min(), Y.max())
    plt.xlabel(&quot;y&quot;)
    plt.ylabel(&quot;z&quot;)
    plt.axis(&quot;scaled&quot;)
    plt.grid(True)
    plt.show()
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>visualize_mode(modes[1], &quot;Hz&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_plugins_sax_sax_64_0.png" src="../../../_images/notebooks_plugins_sax_sax_64_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>plt.pcolormesh(wavelengths, widths, neffs)
plt.xlabel(&quot; [m]&quot;)
plt.ylabel(&quot;width [m]&quot;)
plt.show()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_plugins_sax_sax_65_0.png" src="../../../_images/notebooks_plugins_sax_sax_65_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>_grid = [jnp.sort(jnp.unique(wavelengths)), jnp.sort(jnp.unique(widths))]
_data = jnp.asarray(neffs)


@jax.jit
def _get_coordinate(arr1d: jnp.ndarray, value: jnp.ndarray):
    return jnp.interp(value, arr1d, jnp.arange(arr1d.shape[0]))


@jax.jit
def _get_coordinates(arrs1d: List[jnp.ndarray], values: jnp.ndarray):
    # don&#39;t use vmap as arrays in arrs1d could have different shapes...
    return jnp.array([_get_coordinate(a, v) for a, v in zip(arrs1d, values)])


@jax.jit
def neff(wl=1.55, width=0.5):
    params = jnp.stack(jnp.broadcast_arrays(jnp.asarray(wl), jnp.asarray(width)), 0)
    coords = _get_coordinates(_grid, params)
    return jax.scipy.ndimage.map_coordinates(_data, coords, 1, mode=&quot;nearest&quot;)


neff(wl=[1.52, 1.58], width=[0.5, 0.55])
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">Array</span><span style="font-weight: bold">([</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.4759295</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.4804046</span><span style="font-weight: bold">]</span>, <span style="color: #808000; text-decoration-color: #808000">dtype</span>=<span style="color: #800080; text-decoration-color: #800080">float32</span><span style="font-weight: bold">)</span>
</pre></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>wavelengths_ = np.linspace(wavelengths.min(), wavelengths.max(), 100)
widths_ = np.linspace(widths.min(), widths.max(), 100)
wavelengths_, widths_ = np.meshgrid(wavelengths_, widths_)
neffs_ = neff(wavelengths_, widths_)
plt.pcolormesh(wavelengths_, widths_, neffs_)
plt.xlabel(&quot; [m]&quot;)
plt.ylabel(&quot;width [m]&quot;)
plt.show()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_plugins_sax_sax_67_0.png" src="../../../_images/notebooks_plugins_sax_sax_67_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def straight(wl=1.55, length=10.0, width=0.5):
    S = {
        (&quot;o1&quot;, &quot;o2&quot;): jnp.exp(2j * np.pi * neff(wl=wl, width=width) / wl * length),
    }
    return sax.reciprocal(S)


def mmi1x2():
    &quot;&quot;&quot;Assumes a perfect 1x2 splitter&quot;&quot;&quot;
    return sax.reciprocal(
        {
            (&quot;o1&quot;, &quot;o2&quot;): 0.5**0.5,
            (&quot;o1&quot;, &quot;o3&quot;): 0.5**0.5,
        }
    )


def mmi2x2():
    S = {
        (&quot;o1&quot;, &quot;o3&quot;): 0.5**0.5,
        (&quot;o1&quot;, &quot;o4&quot;): 1j * 0.5**0.5,
        (&quot;o2&quot;, &quot;o3&quot;): 1j * 0.5**0.5,
        (&quot;o2&quot;, &quot;o4&quot;): 0.5**0.5,
    }
    return sax.reciprocal(S)


def bend_euler(wl=1.5, length=20.0, width=0.5):
    &quot;&quot;&quot; &quot;Let&#39;s assume a reduced transmission for the euler bend compared to a straight&quot;&quot;&quot;
    return {k: 0.99 * v for k, v in straight(wl=wl, length=length, width=width).items()}


models = {
    &quot;bend_euler&quot;: bend_euler,
    &quot;mmi1x2&quot;: mmi1x2,
    &quot;mmi2x2&quot;: mmi2x2,
    &quot;straight&quot;: straight,
}
</pre></div>
</div>
</div>
<p>Even though this still is lossless transmission, were at least modeling the phase correctly.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>straight()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">
<span style="font-weight: bold">{</span>
    <span style="font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">'o1'</span>, <span style="color: #008000; text-decoration-color: #008000">'o2'</span><span style="font-weight: bold">)</span>: <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">Array</span><span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.01229993-0.99992436j</span>, <span style="color: #808000; text-decoration-color: #808000">dtype</span>=<span style="color: #800080; text-decoration-color: #800080">complex64</span><span style="font-weight: bold">)</span>,
    <span style="font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">'o2'</span>, <span style="color: #008000; text-decoration-color: #008000">'o1'</span><span style="font-weight: bold">)</span>: <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">Array</span><span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.01229993-0.99992436j</span>, <span style="color: #808000; text-decoration-color: #808000">dtype</span>=<span style="color: #800080; text-decoration-color: #800080">complex64</span><span style="font-weight: bold">)</span>
<span style="font-weight: bold">}</span>
</pre></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>circuit, _ = sax.circuit(mzi.get_netlist(), models=models)
circuit()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">
<span style="font-weight: bold">{</span>
    <span style="font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">'o1'</span>, <span style="color: #008000; text-decoration-color: #008000">'o1'</span><span style="font-weight: bold">)</span>: <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">Array</span><span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.+0.j</span>, <span style="color: #808000; text-decoration-color: #808000">dtype</span>=<span style="color: #800080; text-decoration-color: #800080">complex64</span><span style="font-weight: bold">)</span>,
    <span style="font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">'o2'</span>, <span style="color: #008000; text-decoration-color: #008000">'o2'</span><span style="font-weight: bold">)</span>: <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">Array</span><span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.+0.j</span>, <span style="color: #808000; text-decoration-color: #808000">dtype</span>=<span style="color: #800080; text-decoration-color: #800080">complex64</span><span style="font-weight: bold">)</span>,
    <span style="font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">'o1'</span>, <span style="color: #008000; text-decoration-color: #008000">'o2'</span><span style="font-weight: bold">)</span>: <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">Array</span><span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.00688994+0.00959834j</span>, <span style="color: #808000; text-decoration-color: #808000">dtype</span>=<span style="color: #800080; text-decoration-color: #800080">complex64</span><span style="font-weight: bold">)</span>,
    <span style="font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">'o2'</span>, <span style="color: #008000; text-decoration-color: #008000">'o1'</span><span style="font-weight: bold">)</span>: <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">Array</span><span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.00688994+0.00959831j</span>, <span style="color: #808000; text-decoration-color: #808000">dtype</span>=<span style="color: #800080; text-decoration-color: #800080">complex64</span><span style="font-weight: bold">)</span>
<span style="font-weight: bold">}</span>
</pre></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>wl = jnp.linspace(1.51, 1.59, 1000)
S = circuit(wl=wl)
plt.plot(wl, abs(S[&quot;o1&quot;, &quot;o2&quot;]) ** 2)
plt.ylim(-0.05, 1.05)
plt.xlabel(&quot; [m]&quot;)
plt.ylabel(&quot;T&quot;)
plt.ylim(-0.05, 1.05)
plt.grid(True)
plt.show()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_plugins_sax_sax_72_0.png" src="../../../_images/notebooks_plugins_sax_sax_72_0.png" />
</div>
</div>
</section>
<section id="Circuit-model-with-variability">
<h3>Circuit model with variability<a class="headerlink" href="#Circuit-model-with-variability" title="Permalink to this headline">#</a></h3>
<p>Lets assume the waveguide width changes with a certain correlation length. We can create a wafermap of width variations by randomly varying the width and low pass filtering with a spatial frequency being the inverse of the correlation length (there are probably better ways to do this, but this works for this tutorial).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[54]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def create_wafermaps(placements, correlation_length=1.0, num_maps=1, mean=0.0, std=1.0):
    dx = dy = correlation_length / 200
    xs, ys = [p[&quot;x&quot;] for p in placements.values()], [
        p[&quot;y&quot;] for p in placements.values()
    ]
    xmin, xmax, ymin, ymax = min(xs), max(xs), min(ys), max(ys)
    wx, wy = xmax - xmin, ymax - ymin
    xmin, xmax, ymin, ymax = xmin - wx, xmax + wx, ymin - wy, ymax + wy
    x, y = np.arange(xmin, xmax + dx, dx), np.arange(ymin, ymax + dy, dy)
    W0 = np.random.randn(num_maps, x.shape[0], y.shape[0])

    fx, fy = fftshift(fftfreq(x.shape[0], d=x[1] - x[0])), fftshift(
        fftfreq(y.shape[0], d=y[1] - y[0])
    )
    fY, fX = np.meshgrid(fy, fx)
    fW = fftshift(fft2(W0))

    if correlation_length &gt;= min(x.shape[0], y.shape[0]):
        fW = np.zeros_like(fW)
    else:
        fW = np.where(np.sqrt(fX**2 + fY**2)[None] &gt; 1 / correlation_length, 0, fW)

    W = np.abs(fftshift(ifft2(fW))) ** 2
    mean_ = W.mean(1, keepdims=True).mean(2, keepdims=True)
    std_ = W.std(1, keepdims=True).std(2, keepdims=True)
    if (std_ == 0).all():
        std_ = 1

    W = (W - mean_) / std_
    W = W * std + mean
    return x, y, W
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[55]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>placements = mzi.get_netlist()[&quot;placements&quot;]
xm, ym, wmaps = create_wafermaps(
    placements, correlation_length=100, mean=0.5, std=0.002, num_maps=100
)

for i, wmap in enumerate(wmaps):
    plt.imshow(wmap, cmap=&quot;RdBu&quot;)
    plt.show()
    if i == 2:
        break
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_plugins_sax_sax_75_0.png" src="../../../_images/notebooks_plugins_sax_sax_75_0.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_plugins_sax_sax_75_1.png" src="../../../_images/notebooks_plugins_sax_sax_75_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_plugins_sax_sax_75_2.png" src="../../../_images/notebooks_plugins_sax_sax_75_2.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[56]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def widths(xw, yw, wmaps, x, y):
    _wmap_grid = [xw, yw]
    params = jnp.stack(jnp.broadcast_arrays(jnp.asarray(x), jnp.asarray(y)), 0)
    coords = _get_coordinates(_wmap_grid, params)

    map_coordinates = partial(
        jax.scipy.ndimage.map_coordinates, coordinates=coords, order=1, mode=&quot;nearest&quot;
    )
    w = jax.vmap(map_coordinates)(wmaps)
    return w
</pre></div>
</div>
</div>
<p>Lets now sample the MZI width variation on the wafer map (lets assume a single width variation per point):</p>
</section>
<section id="Simple-MZI">
<h3>Simple MZI<a class="headerlink" href="#Simple-MZI" title="Permalink to this headline">#</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[57]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>@gf.cell
def simple_mzi():
    global bend_top1_
    c = gf.Component()

    # instances
    mmi_in = gf.components.mmi1x2()
    mmi_out = gf.components.mmi2x2()
    bend = gf.components.bend_euler()
    half_delay_straight = gf.components.straight(length=10.0)

    # references (sax convention: vars ending in underscore are references)
    mmi_in_ = c &lt;&lt; mmi_in
    mmi_out_ = c &lt;&lt; mmi_out
    straight_top1_ = c &lt;&lt; half_delay_straight
    straight_top2_ = c &lt;&lt; half_delay_straight
    bend_top1_ = c &lt;&lt; bend
    bend_top2_ = (c &lt;&lt; bend).mirror()
    bend_top3_ = (c &lt;&lt; bend).mirror()
    bend_top4_ = c &lt;&lt; bend
    bend_btm1_ = (c &lt;&lt; bend).mirror()
    bend_btm2_ = c &lt;&lt; bend
    bend_btm3_ = c &lt;&lt; bend
    bend_btm4_ = (c &lt;&lt; bend).mirror()

    # connections
    bend_top1_.connect(&quot;o1&quot;, mmi_in_.ports[&quot;o2&quot;])
    straight_top1_.connect(&quot;o1&quot;, bend_top1_.ports[&quot;o2&quot;])
    bend_top2_.connect(&quot;o1&quot;, straight_top1_.ports[&quot;o2&quot;])
    bend_top3_.connect(&quot;o1&quot;, bend_top2_.ports[&quot;o2&quot;])
    straight_top2_.connect(&quot;o1&quot;, bend_top3_.ports[&quot;o2&quot;])
    bend_top4_.connect(&quot;o1&quot;, straight_top2_.ports[&quot;o2&quot;])

    bend_btm1_.connect(&quot;o1&quot;, mmi_in_.ports[&quot;o3&quot;])
    bend_btm2_.connect(&quot;o1&quot;, bend_btm1_.ports[&quot;o2&quot;])
    bend_btm3_.connect(&quot;o1&quot;, bend_btm2_.ports[&quot;o2&quot;])
    bend_btm4_.connect(&quot;o1&quot;, bend_btm3_.ports[&quot;o2&quot;])

    mmi_out_.connect(&quot;o1&quot;, bend_btm4_.ports[&quot;o2&quot;])

    # ports
    c.add_port(
        &quot;o1&quot;,
        port=mmi_in_.ports[&quot;o1&quot;],
    )
    c.add_port(&quot;o2&quot;, port=mmi_out_.ports[&quot;o3&quot;])
    c.add_port(&quot;o3&quot;, port=mmi_out_.ports[&quot;o4&quot;])
    return c


mzi = simple_mzi()
fig = mzi.plot()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_plugins_sax_sax_78_0.png" src="../../../_images/notebooks_plugins_sax_sax_78_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[58]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>circuit, _ = sax.circuit(mzi.get_netlist(), models=models)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[59]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>mzi_params = sax.get_settings(circuit)
placements = mzi.get_netlist()[&quot;placements&quot;]
width_params = {
    k: {&quot;width&quot;: widths(xm, ym, wmaps, v[&quot;x&quot;], v[&quot;y&quot;])}
    for k, v in placements.items()
    if &quot;width&quot; in mzi_params[k]
}

S0 = circuit(wl=wl)
S = circuit(
    wl=wl[:, None],
    **width_params,
)
ps = plt.plot(wl * 1e3, abs(S[&quot;o1&quot;, &quot;o2&quot;]) ** 2, color=&quot;C0&quot;, lw=1, alpha=0.1)
nps = plt.plot(wl * 1e3, abs(S0[&quot;o1&quot;, &quot;o2&quot;]) ** 2, color=&quot;C1&quot;, lw=2, alpha=1)
plt.xlabel(&quot; [nm]&quot;)
plt.ylabel(&quot;T&quot;)
plt.plot([1550, 1550], [-1, 2], color=&quot;black&quot;, ls=&quot;:&quot;)
plt.ylim(-0.05, 1.05)
plt.grid(True)
plt.figlegend([*ps[-1:], *nps], [&quot;MC&quot;, &quot;nominal&quot;], bbox_to_anchor=(1.1, 0.9))
rmse = jnp.mean(
    jnp.abs(jnp.abs(S[&quot;o1&quot;, &quot;o2&quot;]) ** 2 - jnp.abs(S0[&quot;o1&quot;, &quot;o2&quot;][:, None]) ** 2) ** 2
)
plt.title(f&quot;{rmse=}&quot;)
plt.show()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_plugins_sax_sax_80_0.png" src="../../../_images/notebooks_plugins_sax_sax_80_0.png" />
</div>
</div>
</section>
<section id="Compact-MZI">
<h3>Compact MZI<a class="headerlink" href="#Compact-MZI" title="Permalink to this headline">#</a></h3>
<p>Lets see if we can improve variability (i.e.the RMSE w.r.t. nominal) by making the MZI more compact:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[60]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>@gf.cell
def compact_mzi():
    c = gf.Component()

    # instances
    mmi_in = gf.components.mmi1x2()
    mmi_out = gf.components.mmi2x2()
    bend = gf.components.bend_euler()
    half_delay_straight = gf.components.straight()
    middle_straight = gf.components.straight(length=6.0)
    half_middle_straight = gf.components.straight(3.0)

    # references (sax convention: vars ending in underscore are references)
    mmi_in_ = c &lt;&lt; mmi_in

    bend_top1_ = c &lt;&lt; bend
    straight_top1_ = c &lt;&lt; half_delay_straight
    bend_top2_ = (c &lt;&lt; bend).mirror()
    straight_top2_ = c &lt;&lt; middle_straight
    bend_top3_ = (c &lt;&lt; bend).mirror()
    straight_top3_ = c &lt;&lt; half_delay_straight
    bend_top4_ = c &lt;&lt; bend

    straight_btm1_ = c &lt;&lt; half_middle_straight
    bend_btm1_ = c &lt;&lt; bend
    bend_btm2_ = (c &lt;&lt; bend).mirror()
    bend_btm3_ = (c &lt;&lt; bend).mirror()
    bend_btm4_ = c &lt;&lt; bend
    straight_btm2_ = c &lt;&lt; half_middle_straight

    mmi_out_ = c &lt;&lt; mmi_out

    # connections
    bend_top1_.connect(&quot;o1&quot;, mmi_in_.ports[&quot;o2&quot;])
    straight_top1_.connect(&quot;o1&quot;, bend_top1_.ports[&quot;o2&quot;])
    bend_top2_.connect(&quot;o1&quot;, straight_top1_.ports[&quot;o2&quot;])
    straight_top2_.connect(&quot;o1&quot;, bend_top2_.ports[&quot;o2&quot;])
    bend_top3_.connect(&quot;o1&quot;, straight_top2_.ports[&quot;o2&quot;])
    straight_top3_.connect(&quot;o1&quot;, bend_top3_.ports[&quot;o2&quot;])
    bend_top4_.connect(&quot;o1&quot;, straight_top3_.ports[&quot;o2&quot;])

    straight_btm1_.connect(&quot;o1&quot;, mmi_in_.ports[&quot;o3&quot;])
    bend_btm1_.connect(&quot;o1&quot;, straight_btm1_.ports[&quot;o2&quot;])
    bend_btm2_.connect(&quot;o1&quot;, bend_btm1_.ports[&quot;o2&quot;])
    bend_btm3_.connect(&quot;o1&quot;, bend_btm2_.ports[&quot;o2&quot;])
    bend_btm4_.connect(&quot;o1&quot;, bend_btm3_.ports[&quot;o2&quot;])
    straight_btm2_.connect(&quot;o1&quot;, bend_btm4_.ports[&quot;o2&quot;])

    mmi_out_.connect(&quot;o1&quot;, straight_btm2_.ports[&quot;o2&quot;])

    # ports
    c.add_port(
        &quot;o1&quot;,
        port=mmi_in_.ports[&quot;o1&quot;],
    )
    c.add_port(&quot;o2&quot;, port=mmi_out_.ports[&quot;o3&quot;])
    c.add_port(&quot;o3&quot;, port=mmi_out_.ports[&quot;o4&quot;])
    return c
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[61]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>compact_mzi1 = compact_mzi()
fig = compact_mzi1.plot()
placements = compact_mzi1.get_netlist()[&quot;placements&quot;]
mzi3, _ = sax.circuit(compact_mzi1.get_netlist(), models=models)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_plugins_sax_sax_83_0.png" src="../../../_images/notebooks_plugins_sax_sax_83_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[62]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>mzi_params = sax.get_settings(mzi3)
placements = compact_mzi1.get_netlist()[&quot;placements&quot;]
width_params = {
    k: {&quot;width&quot;: widths(xm, ym, wmaps, v[&quot;x&quot;], v[&quot;y&quot;])}
    for k, v in placements.items()
    if &quot;width&quot; in mzi_params[k]
}

S0 = mzi3(wl=wl)
S = mzi3(
    wl=wl[:, None],
    **width_params,
)
ps = plt.plot(wl * 1e3, abs(S[&quot;o1&quot;, &quot;o2&quot;]) ** 2, color=&quot;C0&quot;, lw=1, alpha=0.1)
nps = plt.plot(wl * 1e3, abs(S0[&quot;o1&quot;, &quot;o2&quot;]) ** 2, color=&quot;C1&quot;, lw=2, alpha=1)
plt.xlabel(&quot; [nm]&quot;)
plt.ylabel(&quot;T&quot;)
plt.plot([1550, 1550], [-1, 2], color=&quot;black&quot;, ls=&quot;:&quot;)
plt.ylim(-0.05, 1.05)
plt.grid(True)
plt.figlegend([*ps[-1:], *nps], [&quot;MC&quot;, &quot;nominal&quot;], bbox_to_anchor=(1.1, 0.9))
rmse = jnp.mean(
    jnp.abs(jnp.abs(S[&quot;o1&quot;, &quot;o2&quot;]) ** 2 - jnp.abs(S0[&quot;o1&quot;, &quot;o2&quot;][:, None]) ** 2) ** 2
)
plt.title(f&quot;{rmse=}&quot;)
plt.show()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_plugins_sax_sax_84_0.png" src="../../../_images/notebooks_plugins_sax_sax_84_0.png" />
</div>
</div>
</section>
</section>
<section id="Tuning">
<h2>Tuning<a class="headerlink" href="#Tuning" title="Permalink to this headline">#</a></h2>
<p>You can make a phase shifter model that depends on the applied volage. For that you need first to figure out whats the model associated to your phase shifter, and what is the parameter that you need to tune.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[63]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import gdsfactory as gf
import numpy as np
import sax
import matplotlib.pyplot as plt
from tqdm import trange
import jax.numpy as jnp
import jax
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[64]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>delta_length = 10
mzi_component = gf.components.mzi_phase_shifter_top_heater_metal(
    delta_length=delta_length
)
fig = mzi_component.plot()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_plugins_sax_sax_87_0.png" src="../../../_images/notebooks_plugins_sax_sax_87_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[65]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def straight(wl=1.5, length=10.0, neff=2.4) -&gt; sax.SDict:
    wl0 = 1.5  # center wavelength for which the waveguide model is defined
    return sax.reciprocal({(&quot;o1&quot;, &quot;o2&quot;): jnp.exp(2j * jnp.pi * neff * length / wl)})


def mmi1x2() -&gt; sax.SDict:
    &quot;&quot;&quot;Returns a perfect 1x2 splitter.&quot;&quot;&quot;
    return sax.reciprocal(
        {
            (&quot;o1&quot;, &quot;o2&quot;): 0.5**0.5,
            (&quot;o1&quot;, &quot;o3&quot;): 0.5**0.5,
        }
    )


def bend_euler(wl=1.5, length=20.0) -&gt; sax.SDict:
    &quot;&quot;&quot;Returns bend Sparameters with reduced transmission compared to a straight.&quot;&quot;&quot;
    return {k: 0.99 * v for k, v in straight(wl=wl, length=length).items()}


def phase_shifter_heater(
    wl: float = 1.55,
    neff: float = 2.34,
    voltage: float = 0,
    length: float = 10,
    loss: float = 0.0,
) -&gt; sax.SDict:
    &quot;&quot;&quot;Returns simple phase shifter model&quot;&quot;&quot;
    deltaphi = voltage * jnp.pi
    phase = 2 * jnp.pi * neff * length / wl + deltaphi
    amplitude = jnp.asarray(10 ** (-loss * length / 20), dtype=complex)
    transmission = amplitude * jnp.exp(1j * phase)
    sdict = sax.reciprocal(
        {
            (&quot;o1&quot;, &quot;o2&quot;): transmission,
        }
    )
    return sdict


models = {
    &quot;bend_euler&quot;: bend_euler,
    &quot;mmi1x2&quot;: mmi1x2,
    &quot;straight&quot;: straight,
    &quot;straight_heater_metal_undercut&quot;: phase_shifter_heater,
}
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[66]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>mzi_component = gf.components.mzi_phase_shifter_top_heater_metal(
    delta_length=delta_length
)
netlist = mzi_component.get_netlist()
mzi_circuit, _ = sax.circuit(netlist=netlist, models=models)
S = mzi_circuit(wl=1.55)
S
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">
<span style="font-weight: bold">{</span>
    <span style="font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">'o1'</span>, <span style="color: #008000; text-decoration-color: #008000">'o1'</span><span style="font-weight: bold">)</span>: <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">Array</span><span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.+0.j</span>, <span style="color: #808000; text-decoration-color: #808000">dtype</span>=<span style="color: #800080; text-decoration-color: #800080">complex64</span><span style="font-weight: bold">)</span>,
    <span style="font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">'o2'</span>, <span style="color: #008000; text-decoration-color: #008000">'o2'</span><span style="font-weight: bold">)</span>: <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">Array</span><span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.+0.j</span>, <span style="color: #808000; text-decoration-color: #808000">dtype</span>=<span style="color: #800080; text-decoration-color: #800080">complex64</span><span style="font-weight: bold">)</span>,
    <span style="font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">'o1'</span>, <span style="color: #008000; text-decoration-color: #008000">'o2'</span><span style="font-weight: bold">)</span>: <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">Array</span><span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.08122635+0.72426844j</span>, <span style="color: #808000; text-decoration-color: #808000">dtype</span>=<span style="color: #800080; text-decoration-color: #800080">complex64</span><span style="font-weight: bold">)</span>,
    <span style="font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">'o2'</span>, <span style="color: #008000; text-decoration-color: #008000">'o1'</span><span style="font-weight: bold">)</span>: <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">Array</span><span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.08122632+0.72426844j</span>, <span style="color: #808000; text-decoration-color: #808000">dtype</span>=<span style="color: #800080; text-decoration-color: #800080">complex64</span><span style="font-weight: bold">)</span>
<span style="font-weight: bold">}</span>
</pre></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[67]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>wl = np.linspace(1.5, 1.6, 256)
S = mzi_circuit(wl=wl)

plt.figure(figsize=(14, 4))
plt.title(&quot;MZI&quot;)
plt.plot(1e3 * wl, jnp.abs(S[&quot;o1&quot;, &quot;o2&quot;]) ** 2)
plt.xlabel(&quot; [nm]&quot;)
plt.ylabel(&quot;T&quot;)
plt.grid(True)
plt.show()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_plugins_sax_sax_90_0.png" src="../../../_images/notebooks_plugins_sax_sax_90_0.png" />
</div>
</div>
<p>Now you can tune the phase shift applied to one of the arms.</p>
<p>How do you find out whats the name of the netlist component that you want to tune?</p>
<p>You can backannotate the netlist and read the labels on the backannotated netlist or you can plot the netlist</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[68]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>mzi_component.plot_netlist()
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">&lt;</span><span style="color: #ff00ff; text-decoration-color: #ff00ff; font-weight: bold">networkx.classes.graph.Graph</span><span style="color: #000000; text-decoration-color: #000000"> object at </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0x7fbf605459d0</span><span style="font-weight: bold">&gt;</span>
</pre></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_plugins_sax_sax_92_1.png" src="../../../_images/notebooks_plugins_sax_sax_92_1.png" />
</div>
</div>
<p>As you can see the top phase shifter instance <code class="docutils literal notranslate"><span class="pre">sxt</span></code> is hard to see on the netlist. You can also reconstruct the component using the netlist and look at the labels in klayout.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[69]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>mzi_yaml = mzi_component.get_netlist_yaml()
mzi_component2 = gf.read.from_yaml(mzi_yaml)
fig = mzi_component2.plot(label_aliases=True)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/runner/work/gdsfactory/gdsfactory/gdsfactory/read/from_yaml.py:691: UserWarning: YAML defined: (bend_euler_7, bend_euler_1, straight_4, bend_euler_2, bend_euler_3, bend_euler_5, bend_euler_6, bend_euler_8, cp2, straight_7, bend_euler_4) with both connection and placement. Please use one or the other.
  warnings.warn(
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_plugins_sax_sax_94_1.png" src="../../../_images/notebooks_plugins_sax_sax_94_1.png" />
</div>
</div>
<p>The best way to get a deterministic name of the <code class="docutils literal notranslate"><span class="pre">instance</span></code> is naming the reference on your Pcell.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[70]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>voltages = np.linspace(-1, 1, num=5)
voltages = [-0.5, 0, 0.5]

for voltage in voltages:
    S = mzi_circuit(
        wl=wl,
        sxt={&quot;voltage&quot;: voltage},
    )
    plt.plot(wl * 1e3, abs(S[&quot;o1&quot;, &quot;o2&quot;]) ** 2, label=str(voltage))
    plt.xlabel(&quot; [nm]&quot;)
    plt.ylabel(&quot;T&quot;)
    plt.ylim(-0.05, 1.05)
    plt.grid(True)

plt.title(&quot;MZI vs voltage&quot;)
plt.legend()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_plugins_sax_sax_96_0.png" src="../../../_images/notebooks_plugins_sax_sax_96_0.png" />
</div>
</div>
</section>
<section id="Optimization">
<h2>Optimization<a class="headerlink" href="#Optimization" title="Permalink to this headline">#</a></h2>
<p>You can optimize an MZI to get T=0 at 1530nm. To do this, you need to define a loss function for the circuit at 1550nm. This function should take the parameters that you want to optimize as positional arguments:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[71]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import gdsfactory as gf
import numpy as np
import sax
import matplotlib.pyplot as plt
from tqdm import trange
import jax.numpy as jnp
import jax
import jax.example_libraries.optimizers as opt
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[72]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def straight(wl=1.5, length=10.0, neff=2.4) -&gt; sax.SDict:
    wl0 = 1.5  # center wavelength for which the waveguide model is defined
    return sax.reciprocal({(&quot;o1&quot;, &quot;o2&quot;): jnp.exp(2j * jnp.pi * neff * length / wl)})


def mmi1x2():
    &quot;&quot;&quot;Assumes a perfect 1x2 splitter&quot;&quot;&quot;
    return sax.reciprocal(
        {
            (&quot;o1&quot;, &quot;o2&quot;): 0.5**0.5,
            (&quot;o1&quot;, &quot;o3&quot;): 0.5**0.5,
        }
    )


def bend_euler(wl=1.5, length=20.0):
    &quot;&quot;&quot; &quot;Let&#39;s assume a reduced transmission for the euler bend compared to a straight&quot;&quot;&quot;
    return {k: 0.99 * v for k, v in straight(wl=wl, length=length).items()}


models = {
    &quot;bend_euler&quot;: bend_euler,
    &quot;mmi1x2&quot;: mmi1x2,
    &quot;straight&quot;: straight,
}
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[73]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>delta_length = 30
mzi_component = gf.components.mzi(delta_length=delta_length)
mzi_circuit, _ = sax.circuit(netlist=mzi_component.get_netlist(), models=models)
S = mzi_circuit(wl=1.55)
S
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">
<span style="font-weight: bold">{</span>
    <span style="font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">'o1'</span>, <span style="color: #008000; text-decoration-color: #008000">'o1'</span><span style="font-weight: bold">)</span>: <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">Array</span><span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.+0.j</span>, <span style="color: #808000; text-decoration-color: #808000">dtype</span>=<span style="color: #800080; text-decoration-color: #800080">complex64</span><span style="font-weight: bold">)</span>,
    <span style="font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">'o2'</span>, <span style="color: #008000; text-decoration-color: #008000">'o2'</span><span style="font-weight: bold">)</span>: <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">Array</span><span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.+0.j</span>, <span style="color: #808000; text-decoration-color: #808000">dtype</span>=<span style="color: #800080; text-decoration-color: #800080">complex64</span><span style="font-weight: bold">)</span>,
    <span style="font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">'o1'</span>, <span style="color: #008000; text-decoration-color: #008000">'o2'</span><span style="font-weight: bold">)</span>: <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">Array</span><span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.11767103-0.08549857j</span>, <span style="color: #808000; text-decoration-color: #808000">dtype</span>=<span style="color: #800080; text-decoration-color: #800080">complex64</span><span style="font-weight: bold">)</span>,
    <span style="font-weight: bold">(</span><span style="color: #008000; text-decoration-color: #008000">'o2'</span>, <span style="color: #008000; text-decoration-color: #008000">'o1'</span><span style="font-weight: bold">)</span>: <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">Array</span><span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">-0.11767103-0.08549854j</span>, <span style="color: #808000; text-decoration-color: #808000">dtype</span>=<span style="color: #800080; text-decoration-color: #800080">complex64</span><span style="font-weight: bold">)</span>
<span style="font-weight: bold">}</span>
</pre></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[74]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>wl = np.linspace(1.5, 1.6, 256)
S = mzi_circuit(wl=wl)

plt.figure(figsize=(14, 4))
plt.title(&quot;MZI&quot;)
plt.plot(1e3 * wl, jnp.abs(S[&quot;o1&quot;, &quot;o2&quot;]) ** 2)
plt.xlabel(&quot; [nm]&quot;)
plt.ylabel(&quot;T&quot;)
plt.plot([1530, 1530], [0, 1])
plt.grid(True)
plt.show()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_plugins_sax_sax_101_0.png" src="../../../_images/notebooks_plugins_sax_sax_101_0.png" />
</div>
</div>
<p>GDSFactory autonames component names for GDS and for netlists uses an incremental name for easier addressing.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[75]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>netlist = mzi_component.get_netlist()
c = gf.read.from_yaml(netlist)
fig = c.plot()
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/runner/work/gdsfactory/gdsfactory/gdsfactory/read/from_yaml.py:691: UserWarning: YAML defined: (bend_euler_7, bend_euler_1, bend_euler_2, straight_5, bend_euler_3, bend_euler_5, bend_euler_6, bend_euler_8, straight_8, cp2, bend_euler_4) with both connection and placement. Please use one or the other.
  warnings.warn(
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_plugins_sax_sax_103_1.png" src="../../../_images/notebooks_plugins_sax_sax_103_1.png" />
</div>
</div>
<p>From this we see that we will need to change <code class="docutils literal notranslate"><span class="pre">syl</span></code> and <code class="docutils literal notranslate"><span class="pre">straight_9</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[76]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>mzi_component = gf.components.mzi(
    delta_length=delta_length,
)
mzi_circuit, _ = sax.circuit(
    netlist=mzi_component.get_netlist(),
    models=models,
)


@jax.jit
def loss_fn(delta_length):
    S = mzi_circuit(
        wl=1.53,
        syl={
            &quot;length&quot;: delta_length / 2 + 2,
        },
        straight_9={
            &quot;length&quot;: delta_length / 2 + 2,
        },
    )
    return (abs(S[&quot;o1&quot;, &quot;o2&quot;]) ** 2).mean()
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[77]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%time loss_fn(20.0)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
CPU times: user 5.85 s, sys: 3.8 ms, total: 5.86 s
Wall time: 5.84 s
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">Array</span><span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.14018838</span>, <span style="color: #808000; text-decoration-color: #808000">dtype</span>=<span style="color: #800080; text-decoration-color: #800080">float32</span><span style="font-weight: bold">)</span>
</pre></div>
</div>
<p>You can use this loss function to define a grad function which works on the parameters of the loss function:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[78]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>grad_fn = jax.jit(
    jax.grad(
        loss_fn,
        argnums=0,  # JAX gradient function for the first positional argument, jitted
    )
)
</pre></div>
</div>
</div>
<p>Next, you need to define a JAX optimizer, which on its own is nothing more than three more functions:</p>
<ol class="arabic simple">
<li><p>an initialization function with which to initialize the optimizer state</p></li>
<li><p>an update function which will update the optimizer state (and with it the model parameters).</p></li>
<li><p>a function with the model parameters given the optimizer state.</p></li>
</ol>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[79]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>initial_delta_length = 30.0
init_fn, update_fn, params_fn = opt.adam(step_size=0.1)
state = init_fn(initial_delta_length)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[80]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def step_fn(step, state):
    settings = params_fn(state)
    loss = loss_fn(settings)
    grad = grad_fn(settings)
    state = update_fn(step, grad, state)
    return loss, state
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[81]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>range_ = trange(100)
for step in range_:
    loss, state = step_fn(step, state)
    range_.set_postfix(loss=f&quot;{loss:.6f}&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|| 100/100 [00:29&lt;00:00,  3.41it/s, loss=0.000012]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[82]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>delta_length = params_fn(state)
delta_length
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">Array</span><span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">30.282084</span>, <span style="color: #808000; text-decoration-color: #808000">dtype</span>=<span style="color: #800080; text-decoration-color: #800080">float32</span><span style="font-weight: bold">)</span>
</pre></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[83]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>S = mzi_circuit(
    wl=wl,
    syl={&quot;length&quot;: delta_length / 2 + 2},
    straight_9={&quot;length&quot;: delta_length / 2 + 2},
)
plt.figure(figsize=(14, 4))
plt.plot(wl * 1e3, abs(S[&quot;o1&quot;, &quot;o2&quot;]) ** 2)
plt.xlabel(&quot; [nm]&quot;)
plt.ylabel(&quot;T&quot;)
plt.ylim(-0.05, 1.05)
plt.plot([1530, 1530], [0, 1])
plt.grid(True)
plt.show()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_plugins_sax_sax_114_0.png" src="../../../_images/notebooks_plugins_sax_sax_114_0.png" />
</div>
</div>
<p>The minimum of the MZI is perfectly located at 1530nm.</p>
</section>
<section id="Hierarchical-circuits">
<h2>Hierarchical circuits<a class="headerlink" href="#Hierarchical-circuits" title="Permalink to this headline">#</a></h2>
<p>You can also simulate hierarchical circuits, such as lattice of MZI interferometers.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[84]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from typing import List

import jax.numpy as jnp
import numpy as np
import sax
import matplotlib.pyplot as plt

import gdsfactory as gf


@gf.cell
def mzis(delta_length=10):
    c = gf.Component()
    c1 = c &lt;&lt; gf.components.mzi(delta_length=delta_length)
    c2 = c &lt;&lt; gf.components.mzi(delta_length=delta_length)
    c2.connect(&quot;o1&quot;, c1.ports[&quot;o2&quot;])

    c.add_port(&quot;o1&quot;, port=c1.ports[&quot;o1&quot;])
    c.add_port(&quot;o2&quot;, port=c2.ports[&quot;o2&quot;])
    return c


def straight(wl=1.5, length=10.0, neff=2.4) -&gt; sax.SDict:
    &quot;&quot;&quot;Straight model.&quot;&quot;&quot;
    return sax.reciprocal({(&quot;o1&quot;, &quot;o2&quot;): jnp.exp(2j * jnp.pi * neff * length / wl)})


def mmi1x2():
    &quot;&quot;&quot;Assumes a perfect 1x2 splitter.&quot;&quot;&quot;
    return sax.reciprocal(
        {
            (&quot;o1&quot;, &quot;o2&quot;): 0.5**0.5,
            (&quot;o1&quot;, &quot;o3&quot;): 0.5**0.5,
        }
    )


def bend_euler(wl=1.5, length=20.0):
    &quot;&quot;&quot;Assumes reduced transmission for the euler bend compared to a straight.&quot;&quot;&quot;
    return {k: 0.99 * v for k, v in straight(wl=wl, length=length).items()}


models = {
    &quot;bend_euler&quot;: bend_euler,
    &quot;mmi1x2&quot;: mmi1x2,
    &quot;straight&quot;: straight,
}


c2 = mzis()
fig = c2.plot()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_plugins_sax_sax_117_0.png" src="../../../_images/notebooks_plugins_sax_sax_117_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[85]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>c1 = gf.components.mzi(delta_length=10)
fig = c1.plot()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_plugins_sax_sax_118_0.png" src="../../../_images/notebooks_plugins_sax_sax_118_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[86]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>wl = np.linspace(1.5, 1.6)
netlist1 = c1.get_netlist_recursive()
circuit1, _ = sax.circuit(netlist=netlist1, models=models)
S1 = circuit1(wl=wl)

netlist2 = c2.get_netlist_recursive()
circuit2, _ = sax.circuit(netlist=netlist2, models=models)
S2 = circuit2(wl=wl)

plt.figure(figsize=(14, 4))
plt.plot(1e3 * wl, jnp.abs(S1[&quot;o1&quot;, &quot;o2&quot;]) ** 2, label=&quot;1 MZI&quot;)
plt.plot(1e3 * wl, jnp.abs(S2[&quot;o1&quot;, &quot;o2&quot;]) ** 2, label=&quot;2 MZI&quot;)
plt.xlabel(&quot; [nm]&quot;)
plt.ylabel(&quot;T&quot;)
plt.grid(True)
plt.legend()
plt.show()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/notebooks_plugins_sax_sax_119_0.png" src="../../../_images/notebooks_plugins_sax_sax_119_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<script type="application/vnd.jupyter.widget-state+json">
{"state": {"5a594c9476224e53af4e7fb05fa4e39d": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "52fd97f9adf245b1aed5708469b04f87": {"model_name": "ProgressStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "ProgressStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "StyleView", "bar_color": null, "description_width": ""}}, "a58bcafd33de4a84bd9613362bedc297": {"model_name": "FloatProgressModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "FloatProgressModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "ProgressView", "bar_style": "success", "description": "", "description_allow_html": false, "layout": "IPY_MODEL_5a594c9476224e53af4e7fb05fa4e39d", "max": 12.0, "min": 0.0, "orientation": "horizontal", "style": "IPY_MODEL_52fd97f9adf245b1aed5708469b04f87", "tabbable": null, "tooltip": null, "value": 12.0}}, "39bd3194f357449d95eab84a6c08e287": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "72a15858cfb649b7aebdb7ed289f9cec": {"model_name": "HTMLStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "StyleView", "background": null, "description_width": "", "font_size": null, "text_color": null}}, "efdafbb8990c4dc984b212ebb9868566": {"model_name": "HTMLModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "HTMLView", "description": "", "description_allow_html": false, "layout": "IPY_MODEL_39bd3194f357449d95eab84a6c08e287", "placeholder": "\u200b", "style": "IPY_MODEL_72a15858cfb649b7aebdb7ed289f9cec", "tabbable": null, "tooltip": null, "value": "100%"}}, "91043cf326e74b5c862992d494056a55": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "49f4f0b65dd04279b86c72327e8b825d": {"model_name": "HTMLStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "StyleView", "background": null, "description_width": "", "font_size": null, "text_color": null}}, "5b8bc4d790a04b5984ba9e8fcfe45c23": {"model_name": "HTMLModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "HTMLView", "description": "", "description_allow_html": false, "layout": "IPY_MODEL_91043cf326e74b5c862992d494056a55", "placeholder": "\u200b", "style": "IPY_MODEL_49f4f0b65dd04279b86c72327e8b825d", "tabbable": null, "tooltip": null, "value": " 12/12 [00:00&lt;00:00, 152.47it/s]"}}, "e98f3a903be04b4ca5d31d91a689d897": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "4e72f52e9ca642168bb3e1e624c071e8": {"model_name": "HBoxModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HBoxModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "HBoxView", "box_style": "", "children": ["IPY_MODEL_efdafbb8990c4dc984b212ebb9868566", "IPY_MODEL_a58bcafd33de4a84bd9613362bedc297", "IPY_MODEL_5b8bc4d790a04b5984ba9e8fcfe45c23"], "layout": "IPY_MODEL_e98f3a903be04b4ca5d31d91a689d897", "tabbable": null, "tooltip": null}}, "1ed1274d4514414fa42ba4c27b466957": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "a6bc76570c0b4eb9a23e6eb37239840b": {"model_name": "ProgressStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "ProgressStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "StyleView", "bar_color": null, "description_width": ""}}, "33a89f232d384752bccb942ce0a5c5b7": {"model_name": "FloatProgressModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "FloatProgressModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "ProgressView", "bar_style": "success", "description": "", "description_allow_html": false, "layout": "IPY_MODEL_1ed1274d4514414fa42ba4c27b466957", "max": 50.0, "min": 0.0, "orientation": "horizontal", "style": "IPY_MODEL_a6bc76570c0b4eb9a23e6eb37239840b", "tabbable": null, "tooltip": null, "value": 50.0}}, "173652f181f343eeadc93ed60b917e51": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "ef98cc1ca947468ebcfdde37936d0a89": {"model_name": "HTMLStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "StyleView", "background": null, "description_width": "", "font_size": null, "text_color": null}}, "b4666e4912224553b24e97f676e4479c": {"model_name": "HTMLModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "HTMLView", "description": "", "description_allow_html": false, "layout": "IPY_MODEL_173652f181f343eeadc93ed60b917e51", "placeholder": "\u200b", "style": "IPY_MODEL_ef98cc1ca947468ebcfdde37936d0a89", "tabbable": null, "tooltip": null, "value": "100%"}}, "591a959a3b444f1da23e3dd667e47b96": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "909a49ad732740348a803694ac02abbc": {"model_name": "HTMLStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "StyleView", "background": null, "description_width": "", "font_size": null, "text_color": null}}, "c05c8307445140d291b6bcb0e5b3b11a": {"model_name": "HTMLModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "HTMLView", "description": "", "description_allow_html": false, "layout": "IPY_MODEL_591a959a3b444f1da23e3dd667e47b96", "placeholder": "\u200b", "style": "IPY_MODEL_909a49ad732740348a803694ac02abbc", "tabbable": null, "tooltip": null, "value": " 50/50 [00:00&lt;00:00, 292.32it/s]"}}, "ccbdf7cd08a741e19c72abeaa5377d55": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "edb36127b12945288d5b5b21d6725d4c": {"model_name": "HBoxModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HBoxModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "HBoxView", "box_style": "", "children": ["IPY_MODEL_b4666e4912224553b24e97f676e4479c", "IPY_MODEL_33a89f232d384752bccb942ce0a5c5b7", "IPY_MODEL_c05c8307445140d291b6bcb0e5b3b11a"], "layout": "IPY_MODEL_ccbdf7cd08a741e19c72abeaa5377d55", "tabbable": null, "tooltip": null}}}, "version_major": 2, "version_minor": 0}
</script></section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="../../../plugins_circuits.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Plugins: Circuit simulators</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../lumerical/2_interconnect.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Lumerical INTERCONNECT</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
      &copy; Copyright 2020, MIT License.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>